<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞–π—Ç–∏ —Å–µ–±—è - –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { 
            max-width: 100%; 
            margin: 0 auto;
        }
        
        .screen { 
            display: none; 
            animation: fadeIn 0.3s ease-in;
        }
        
        .active { 
            display: block; 
        }
        
        .card { 
            background: white; 
            padding: 25px; 
            margin: 10px 0; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            border: none; 
            padding: 15px 20px; 
            margin: 8px 0; 
            border-radius: 12px; 
            width: 100%; 
            font-size: 16px; 
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-secondary { 
            background: #6c757d; 
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
        }
        
        h1 { 
            color: #333; 
            margin-bottom: 10px; 
            font-size: 24px;
        }
        
        h2 { 
            color: #444; 
            margin-bottom: 15px; 
            font-size: 20px;
        }
        
        p { 
            color: #666; 
            line-height: 1.6; 
            margin-bottom: 15px;
        }
        
        .progress-bar {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .question-card {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }
        
        .score-btn {
            background: white;
            color: #333;
            border: 2px solid #e0e0e0;
            margin: 5px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-weight: bold;
        }
        
        .score-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .journal-entry {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            resize: vertical;
            margin: 10px 0;
        }
        
        .entry-card {
            background: #f8f9fa;
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .entry-date {
            color: #888;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .back-btn {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 15px;
            margin-bottom: 15px;
            width: auto;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .practice-step {
            margin: 20px 0;
            padding: 15px;
            background: #f0f4ff;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loading-screen" class="screen active">
            <div class="card" style="text-align: center; padding: 40px 20px;">
                <h1>‚è≥</h1>
                <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ...</p>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="main-screen" class="screen">
            <div class="card">
                <h1>üíñ –ù–∞–π—Ç–∏ —Å–µ–±—è</h1>
                <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à–µ –ª–∏—á–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ó–¥–µ—Å—å –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –≤–µ—Å—Ç–∏ –¥–Ω–µ–≤–Ω–∏–∫.</p>
                
                <div style="display: grid; gap: 10px; margin: 20px 0;">
                    <button class="btn" onclick="showScreen('diagnostics-screen')">
                        ü©∫ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ã–≥–æ—Ä–∞–Ω–∏—è
                    </button>
                    <button class="btn" onclick="showScreen('practices-screen')">
                        üßò –ü—Ä–∞–∫—Ç–∏–∫–∏ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                    </button>
                    <button class="btn" onclick="showScreen('journal-screen')">
                        üìñ –ú–æ–π –¥–Ω–µ–≤–Ω–∏–∫
                    </button>
                    <button class="btn btn-outline" onclick="showScreen('profile-screen')">
                        üë§ –ü—Ä–æ—Ñ–∏–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </div>
            </div>
        </div>

        <!-- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -->
        <div id="diagnostics-screen" class="screen">
            <button class="back-btn" onclick="showScreen('main-screen')">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="card">
                <h2>ü©∫ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ã–≥–æ—Ä–∞–Ω–∏—è</h2>
                <div id="diagnostics-content"></div>
            </div>
        </div>

        <!-- –ü—Ä–∞–∫—Ç–∏–∫–∏ -->
        <div id="practices-screen" class="screen">
            <button class="back-btn" onclick="showScreen('main-screen')">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="card">
                <h2>üßò –ü—Ä–∞–∫—Ç–∏–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</h2>
                <div id="practices-content">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã:</p>
                    <button class="btn" onclick="startPractice('love-field')">
                        üíñ –ü–æ–ª–µ –õ—é–±–≤–∏ (–∞—É–¥–∏–æ–º–µ–¥–∏—Ç–∞—Ü–∏—è)
                    </button>
                    <button class="btn" onclick="startPractice('transfiguration')">
                        üåü –ü—Ä–∞–∫—Ç–∏–∫–∞ "–ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
                    </button>
                    <button class="btn" onclick="startPractice('agreement')">
                        ‚úçÔ∏è –°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π
                    </button>
                </div>
            </div>
        </div>

        <!-- –î–Ω–µ–≤–Ω–∏–∫ -->
        <div id="journal-screen" class="screen">
            <button class="back-btn" onclick="showScreen('main-screen')">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="card">
                <h2>üìñ –ú–æ–π –¥–Ω–µ–≤–Ω–∏–∫</h2>
                <textarea class="journal-entry" id="journal-text" 
                          placeholder="–ß—Ç–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–≥–æ–¥–Ω—è? –ö–∞–∫–∏–µ –º—ã—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç? –ß—Ç–æ –≤–∞–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å?"></textarea>
                <button class="btn" onclick="saveJournalEntry()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                
                <div id="journal-entries" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile-screen" class="screen">
            <button class="back-btn" onclick="showScreen('main-screen')">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="card">
                <h2>üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
                <div id="profile-content"></div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        let appState = {};
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            tg.expand();
            tg.enableClosingConfirmation();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ localStorage
            appState = {
                user: tg.initDataUnsafe?.user || { first_name: '–î—Ä—É–≥' },
                testResults: JSON.parse(localStorage.getItem('testResults')) || null,
                journalEntries: JSON.parse(localStorage.getItem('journalEntries')) || [],
                practiceProgress: JSON.parse(localStorage.getItem('practiceProgress')) || {}
            };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {
                showScreen('main-screen');
                updateProfileScreen();
            }, 1000);
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤
            switch(screenId) {
                case 'diagnostics-screen':
                    initDiagnostics();
                    break;
                case 'journal-screen':
                    loadJournalEntries();
                    break;
                case 'practices-screen':
                    resetPracticesScreen();
                    break;
            }
        }
        
        // ===== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –í–´–ì–û–†–ê–ù–ò–Ø =====
        const burnoutQuestions = [
            "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –æ–ø—É—Å—Ç–æ—à–µ–Ω–Ω—ã–º(–æ–π)",
            "–ö –∫–æ–Ω—Ü—É –¥–Ω—è —è —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –∫–∞–∫ ¬´–≤—ã–∂–∞—Ç—ã–π –ª–∏–º–æ–Ω¬ª",
            "–Ø —Å—Ç–∞–ª(–∞) –±–æ–ª–µ–µ —Ü–∏–Ω–∏—á–Ω—ã–º(–æ–π) –∏–ª–∏ –±–µ–∑—Ä–∞–∑–ª–∏—á–Ω—ã–º(–æ–π) –∫ –¥—Ä—É–≥–∏–º",
            "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –º–æ–∏ —É—Å–∏–ª–∏—è –Ω–µ –ø—Ä–∏–Ω–æ—Å—è—Ç –∑–Ω–∞—á–∏–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤",
            "–Ø —Å —Ç—Ä—É–¥–æ–º –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É—é—Å—å –Ω–∞ –∑–∞–¥–∞—á–∞—Ö",
            "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
            "–ú–µ–Ω—è —Ä–∞–∑–¥—Ä–∞–∂–∞—é—Ç –º–µ–ª–∫–∏–µ –Ω–µ—É–¥–∞—á–∏ –∏ –ø–æ–º–µ—Ö–∏",
            "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —É—Å—Ç–∞–≤—à–∏–º(–µ–π) —É–∂–µ —Å —É—Ç—Ä–∞",
            "–ú–Ω–µ —Å–ª–æ–∂–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å motivation –¥–ª—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π",
            "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –¥–≤–∏–≥–∞—é—Å—å –ø–æ –∑–∞–º–∫–Ω—É—Ç–æ–º—É –∫—Ä—É–≥—É"
        ];
        
        let currentQuestionIndex = 0;
        let userAnswers = [];
        
        function initDiagnostics() {
            currentQuestionIndex = 0;
            userAnswers = [];
            showQuestion();
        }
        
        function showQuestion() {
            const content = document.getElementById('diagnostics-content');
            const progress = ((currentQuestionIndex) / burnoutQuestions.length) * 100;
            
            if (currentQuestionIndex < burnoutQuestions.length) {
                content.innerHTML = `
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                    <p>–í–æ–ø—Ä–æ—Å ${currentQuestionIndex + 1} –∏–∑ ${burnoutQuestions.length}</p>
                    <div class="question-card">
                        <h3>${burnoutQuestions[currentQuestionIndex]}</h3>
                    </div>
                    <p>–û—Ü–µ–Ω–∏—Ç–µ –ø–æ —à–∫–∞–ª–µ –æ—Ç 1 –¥–æ 5:</p>
                    <div style="display: flex; justify-content: center; flex-wrap: wrap; margin: 20px 0;">
                        ${[1,2,3,4,5].map(score => `
                            <button class="score-btn" onclick="answerQuestion(${score})">${score}</button>
                        `).join('')}
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #888;">
                        <span>1 - –ù–∏–∫–æ–≥–¥–∞</span>
                        <span>3 - –ò–Ω–æ–≥–¥–∞</span>
                        <span>5 - –ü–æ—Å—Ç–æ—è–Ω–Ω–æ</span>
                    </div>
                `;
            } else {
                showDiagnosticsResults();
            }
        }
        
        function answerQuestion(score) {
            userAnswers.push(score);
            currentQuestionIndex++;
            showQuestion();
        }
        
        function showDiagnosticsResults() {
            const totalScore = userAnswers.reduce((sum, score) => sum + score, 0);
            const averageScore = totalScore / userAnswers.length;
            const maxScore = burnoutQuestions.length * 5;
            const percentage = (totalScore / maxScore) * 100;
            
            let resultLevel, recommendation;
            
            if (averageScore >= 4) {
                resultLevel = "üî¥ –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è";
                recommendation = "–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.";
            } else if (averageScore >= 2.5) {
                resultLevel = "üü° –£–º–µ—Ä–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å";
                recommendation = "–•–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø–æ–º–æ–≥—É—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å.";
            } else {
                resultLevel = "üü¢ –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å";
                recommendation = "–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –≥–∞—Ä–º–æ–Ω–∏–∏.";
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            appState.testResults = {
                score: totalScore,
                average: averageScore,
                level: resultLevel,
                date: new Date().toLocaleDateString('ru-RU')
            };
            localStorage.setItem('testResults', JSON.stringify(appState.testResults));
            
            document.getElementById('diagnostics-content').innerHTML = `
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</h3>
                <div style="text-align: center; margin: 20px 0;">
                    <div style="font-size: 48px; margin: 10px 0;">${totalScore}/${maxScore}</div>
                    <div style="font-size: 18px; font-weight: bold; margin: 10px 0;">${resultLevel}</div>
                </div>
                <p>${recommendation}</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${percentage}%"></div>
                </div>
                <button class="btn" onclick="showScreen('practices-screen')">
                    üßò –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
                </button>
                <button class="btn btn-outline" onclick="initDiagnostics()">
                    üîÑ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ
                </button>
            `;
        }
        
        // ===== –ü–†–ê–ö–¢–ò–ö–ò =====
        function startPractice(practiceType) {
            const content = document.getElementById('practices-content');
            
            switch(practiceType) {
                case 'love-field':
                    content.innerHTML = `
                        <h3>üíñ –ü–æ–ª–µ –õ—é–±–≤–∏</h3>
                        <div class="practice-step">
                            <p><strong>–®–∞–≥ 1:</strong> –£—Å—Ç—Ä–æ–π—Ç–µ—Å—å —É–¥–æ–±–Ω–æ, –∑–∞–∫—Ä–æ–π—Ç–µ –≥–ª–∞–∑–∞</p>
                            <p><strong>–®–∞–≥ 2:</strong> –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</p>
                            <p><strong>–®–∞–≥ 3:</strong> –ù–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ —Å–≤–µ—Ç–æ–º –∏ —Ç–µ–ø–ª–æ–º</p>
                        </div>
                        <audio controls style="width: 100%; margin: 15px 0;">
                            <source src="https://example.com/audio/love-field.mp3" type="audio/mpeg">
                            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ
                        </audio>
                        <button class="btn" onclick="completePractice('love-field')">
                            ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É
                        </button>
                    `;
                    break;
                    
                case 'transfiguration':
                    startTransfigurationPractice();
                    break;
                    
                case 'agreement':
                    content.innerHTML = `
                        <h3>‚úçÔ∏è –°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π</h3>
                        <textarea class="journal-entry" placeholder="–ß—Ç–æ —è –æ–±–µ—â–∞—é —Å–µ–±–µ? –ö–∞–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é? –ß—Ç–æ –≤–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –¥–ª—è –º–æ–µ–≥–æ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏—è?"></textarea>
                        <button class="btn" onclick="saveAgreement()">
                            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
                        </button>
                    `;
                    break;
            }
        }
        
        function startTransfigurationPractice() {
            const steps = [
                "–í—Å–ø–æ–º–Ω–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é, –≥–¥–µ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –±–æ–ª—å, —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ...",
                "–ß—Ç–æ –≤—ã –≤–∏–¥–∏—Ç–µ –≤ —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏? –û–ø–∏—à–∏—Ç–µ –æ–±—Ä–∞–∑—ã, —Ü–≤–µ—Ç–∞, –¥–µ—Ç–∞–ª–∏...",
                "–ö–∞–∫–∏–µ —á—É–≤—Å—Ç–≤–∞ –∏ —ç–º–æ—Ü–∏–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç? –ù–∞–∑–æ–≤–∏—Ç–µ –∏—Ö...",
                "–ß—Ç–æ —ç—Ç–∞ —Å–∏—Ç—É–∞—Ü–∏—è –ø—ã—Ç–∞–µ—Ç—Å—è –≤–∞–º —Å–∫–∞–∑–∞—Ç—å? –ö–∞–∫–æ–π —É—Ä–æ–∫ –≤ –Ω–µ–π?",
                "–ö–∞–∫–æ–π —Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥ –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è?"
            ];
            
            let currentStep = 0;
            
            function showStep() {
                const content = document.getElementById('practices-content');
                content.innerHTML = `
                    <h3>üåü –ü—Ä–∞–∫—Ç–∏–∫–∞ "–ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ"</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(currentStep / steps.length) * 100}%"></div>
                    </div>
                    <p>–®–∞–≥ ${currentStep + 1} –∏–∑ ${steps.length}</p>
                    <div class="practice-step">
                        <p>${steps[currentStep]}</p>
                        <textarea class="journal-entry" id="step-answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."></textarea>
                    </div>
                    <button class="btn" onclick="nextStep()">
                        ${currentStep === steps.length - 1 ? 'üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å' : '‚û°Ô∏è –î–∞–ª–µ–µ'}
                    </button>
                `;
            }
            
            window.nextStep = function() {
                const answer = document.getElementById('step-answer').value;
                if (answer.trim()) {
                    if (currentStep < steps.length - 1) {
                        currentStep++;
                        showStep();
                    } else {
                        document.getElementById('practices-content').innerHTML = `
                            <div style="text-align: center; padding: 40px 20px;">
                                <h3>üéâ –ü—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h3>
                                <p>–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –≤–∞—Å –∑–∞ –≥–ª—É–±–æ–∫—É—é —Ä–∞–±–æ—Ç—É. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∑–∞–ø–∏—Å–∞—Ç—å insights –≤ –¥–Ω–µ–≤–Ω–∏–∫.</p>
                                <button class="btn" onclick="showScreen('journal-screen')">
                                    üìñ –û—Ç–∫—Ä—ã—Ç—å –¥–Ω–µ–≤–Ω–∏–∫
                                </button>
                                <button class="btn btn-outline" onclick="resetPracticesScreen()">
                                    ‚Ü©Ô∏è –ö —Å–ø–∏—Å–∫—É –ø—Ä–∞–∫—Ç–∏–∫
                                </button>
                            </div>
                        `;
                    }
                } else {
                    tg.showPopup({
                        title: '–í–Ω–∏–º–∞–Ω–∏–µ',
                        message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º',
                        buttons: [{ type: 'ok' }]
                    });
                }
            };
            
            showStep();
        }
        
        function resetPracticesScreen() {
            document.getElementById('practices-content').innerHTML = `
                <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã:</p>
                <button class="btn" onclick="startPractice('love-field')">
                    üíñ –ü–æ–ª–µ –õ—é–±–≤–∏ (–∞—É–¥–∏–æ–º–µ–¥–∏—Ç–∞—Ü–∏—è)
                </button>
                <button class="btn" onclick="startPractice('transfiguration')">
                    üåü –ü—Ä–∞–∫—Ç–∏–∫–∞ "–ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
                </button>
                <button class="btn" onclick="startPractice('agreement')">
                    ‚úçÔ∏è –°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π
                </button>
            `;
        }
        
        function completePractice(practiceName) {
            tg.showPopup({
                title: '–ü—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞',
                message: '–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø—Ä–∞–∫—Ç–∏–∫–∞–º.',
                buttons: [{ type: 'ok' }]
            });
        }
        
        // ===== –î–ù–ï–í–ù–ò–ö =====
        function saveJournalEntry() {
            const text = document.getElementById('journal-text').value.trim();
            if (text) {
                const entry = {
                    date: new Date().toLocaleString('ru-RU'),
                    text: text,
                    timestamp: Date.now()
                };
                
                appState.journalEntries.unshift(entry);
                localStorage.setItem('journalEntries', JSON.stringify(appState.journalEntries));
                
                document.getElementById('journal-text').value = '';
                loadJournalEntries();
                
                tg.showPopup({
                    title: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ',
                    message: '–ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –¥–Ω–µ–≤–Ω–∏–∫',
                    buttons: [{ type: 'ok' }]
                });
            }
        }
        
        function loadJournalEntries() {
            const container = document.getElementById('journal-entries');
            if (appState.journalEntries.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888; margin: 40px 0;">–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                return;
            }
            
            container.innerHTML = appState.journalEntries.map(entry => `
                <div class="entry-card">
                    <div class="entry-date">${entry.date}</div>
                    <div>${entry.text}</div>
                </div>
            `).join('');
        }
        
        // ===== –ü–†–û–§–ò–õ–¨ =====
        function updateProfileScreen() {
            const content = document.getElementById('profile-content');
            const userName = appState.user.first_name || '–î—Ä—É–≥';
            
            content.innerHTML = `
                <p>üëã –ü—Ä–∏–≤–µ—Ç, ${userName}!</p>
                
                ${appState.testResults ? `
                    <div style="margin: 20px 0; padding: 15px; background: #f0f4ff; border-radius: 10px;">
                        <h4>üìä –ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h4>
                        <p>–î–∞—Ç–∞: ${appState.testResults.date}</p>
                        <p>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${appState.testResults.level}</p>
                        <p>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${appState.testResults.average.toFixed(1)}/5</p>
                    </div>
                ` : '<p>–í—ã –µ—â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</p>'}
                
                <div style="margin: 20px 0;">
                    <h4>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                    <p>–ó–∞–ø–∏—Å–µ–π –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ: ${appState.journalEntries.length}</p>
                </div>
                
                <button class="btn btn-outline" onclick="exportData()">
                    üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                </button>
                
                <button class="btn btn-secondary" onclick="clearData()" style="margin-top: 10px;">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                </button>
            `;
        }
        
        function exportData() {
            const dataStr = JSON.stringify(appState, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            tg.showPopup({
                title: '–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö',
                message: '–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏',
                buttons: [{ type: 'ok' }]
            });
        }
        
        function clearData() {
            tg.showConfirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.", (confirmed) => {
                if (confirmed) {
                    localStorage.clear();
                    appState = {
                        user: tg.initDataUnsafe?.user || { first_name: '–î—Ä—É–≥' },
                        testResults: null,
                        journalEntries: [],
                        practiceProgress: {}
                    };
                    updateProfileScreen();
                    tg.showPopup({
                        title: '–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã',
                        message: '–í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã',
                        buttons: [{ type: 'ok' }]
                    });
                }
            });
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
