<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è ‚Äî –ù–∞–π—Ç–∏ —Å–µ–±—è</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg: #f6f9ff;
    --card: #fff;
    --muted: #6b7280;
    --accent-1:#5b6df6;
    --accent-2:#8b5cf6;
    --surface: linear-gradient(180deg,#fff,#fbfdff);
    --radius:14px;
    --shadow: 0 10px 30px rgba(2,6,23,0.06);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#0b1220; --card:#071029; --muted:#9aa4b2;
      --accent-1:#6ea0ff; --accent-2:#b792ff;
    }
    body { color: #e6eef8; }
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; background:var(--bg); color:#071028; }
  .wrap{ max-width:1120px; margin:20px auto; padding:18px; display:grid; grid-template-columns: 1fr 340px; gap:20px; align-items:start; }
  @media (max-width:980px){ .wrap{ grid-template-columns:1fr; padding:12px } .sidebar{ position: static; } }

  .card{ background:var(--card); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); border:1px solid rgba(2,6,23,0.04); }
  .hero{ display:flex; gap:14px; align-items:center; }
  .logo{ width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent-1),var(--accent-2)); color:white; display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px }
  h1{ font-size:20px; margin:0 }
  p.muted{ color:var(--muted); margin:6px 0 0; font-size:14px }

  .controls{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap }
  .btn{ border:none; cursor:pointer; padding:10px 14px; border-radius:12px; font-weight:600; font-size:14px }
  .btn-primary{ background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:white; box-shadow: 0 8px 30px rgba(91,109,246,0.12) }
  .btn-ghost{ background:transparent; border:1px solid rgba(2,6,23,0.06); color:var(--muted) }
  .btn-outline{ background:transparent; border:1px solid rgba(91,109,246,0.12); color:var(--accent-1) }

  .sidebar .card{ position:sticky; top:20px; }

  /* Grid blocks */
  .grid-2{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin-top:14px }
  .small{ padding:12px; border-radius:10px; background:linear-gradient(180deg,#fff,#fbfdff); border:1px solid rgba(2,6,23,0.03) }

  /* Tests UI */
  .progress{ height:10px; background:#eef2ff; border-radius:999px; overflow:hidden; margin:12px 0 }
  .progress > i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); transition:width .4s cubic-bezier(.2,.9,.2,1); }

  .question{ background:linear-gradient(180deg,#fff,#fcfeff); border-left:4px solid rgba(91,109,246,0.12); padding:14px; border-radius:10px; }
  .scores{ margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center }
  .score{ width:48px;height:48px;border-radius:10px;border:1px solid rgba(2,6,23,0.04); display:grid;place-items:center;font-weight:700;background:#fff; cursor:pointer; transition:all .12s }
  .score:hover{ transform:translateY(-6px); box-shadow:0 12px 30px rgba(91,109,246,0.06) }
  .score.active{ background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:white; border:none }

  /* Steps */
  .steps{ display:flex; gap:8px; justify-content:center; margin:10px 0 }
  .dot{ width:10px;height:10px;border-radius:999px;background:#e6eefc }
  .dot.active{ background:linear-gradient(90deg,var(--accent-1),var(--accent-2)) }

  textarea{ width:100%; min-height:110px; padding:12px; border-radius:10px; border:1px solid rgba(2,6,23,0.04); font-family:inherit; font-size:15px }

  .muted-block{ color:var(--muted); font-size:13px }

  footer{ margin-top:20px; text-align:center; font-size:13px; color:var(--muted) }
</style>
</head>
<body>
  <div class="wrap">
    <main>
      <!-- HERO -->
      <section class="card hero" aria-labelledby="hero-title">
        <div class="logo">–ùC</div>
        <div>
          <h1 id="hero-title">–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è ‚Äî ¬´–ù–∞–π—Ç–∏ —Å–µ–±—è¬ª</h1>
          <p class="muted">–ö–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ—Å—Ç—ã, –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –¥–Ω–µ–≤–Ω–∏–∫. –í—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.</p>

          <div class="controls" style="margin-top:12px">
            <button class="btn btn-primary" id="btn-start">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –ø—É—Ç—å</button>
            <button class="btn btn-outline" id="btn-features">üîç –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏</button>
            <button class="btn btn-ghost" id="btn-book">üìñ –û –∫–Ω–∏–≥–µ</button>
          </div>
        </div>
      </section>

      <!-- FEATURES -->
      <section class="card" id="features" style="margin-top:16px; display:none">
        <h2>–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏</h2>
        <p class="muted-block">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞, —Ç–µ—Å—Ç—ã, –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –¥–Ω–µ–≤–Ω–∏–∫. –í—Å—ë –ø—Ä–æ –∑–∞–±–æ—Ç—É, –∞ –Ω–µ –ø—Ä–æ –¥–∞–≤–ª–µ–Ω–∏–µ.</p>

        <div class="grid-2" style="margin-top:12px">
          <div class="small"><strong>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ¬´6 —É—Ä–æ–≤–Ω–µ–π¬ª</strong><div class="muted-block">12 –≤–æ–ø—Ä–æ—Å–æ–≤ ~5 –º–∏–Ω—É—Ç</div></div>
          <div class="small"><strong>–¢–µ—Å—Ç –Ω–∞ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ</strong><div class="muted-block">22 –≤–æ–ø—Ä–æ—Å–∞ (Maslach)</div></div>
          <div class="small"><strong>–ü—Ä–∞–∫—Ç–∏–∫–∏</strong><div class="muted-block">–ü–æ–ª–µ –ª—é–±–≤–∏, –ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –°–æ–≥–ª–∞—à–µ–Ω–∏–µ</div></div>
          <div class="small"><strong>–î–Ω–µ–≤–Ω–∏–∫</strong><div class="muted-block">–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –±–æ—Ç–∞</div></div>
        </div>
      </section>

      <!-- DIAGNOSTICS MENU -->
      <section class="card" id="diagnostics-menu" style="margin-top:16px">
        <h2>–ù–∞—á–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</h2>
        <p class="muted-block">–í—ã–±–µ—Ä–∏ —Ç–µ—Å—Ç ‚Äî –æ–Ω –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –≥–¥–µ —Å–µ–π—á–∞—Å —Ä–µ—Å—É—Ä—Å—ã, –∞ –≥–¥–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.</p>
        <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn btn-primary" id="start-6levels">üß≠ ¬´–ú–æ–∏ 6 —É—Ä–æ–≤–Ω–µ–π¬ª</button>
          <button class="btn btn-outline" id="start-burnout">üî• –¢–µ—Å—Ç –Ω–∞ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ (Maslach)</button>
          <button class="btn btn-ghost" id="to-practices">üåø –ö –ø—Ä–∞–∫—Ç–∏–∫–∞–º</button>
        </div>
      </section>

      <!-- SIX LEVELS -->
      <section class="card" id="six-levels" style="margin-top:16px; display:none">
        <button class="btn btn-ghost" id="six-back">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
        <h2>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ¬´–ú–æ–∏ 6 —É—Ä–æ–≤–Ω–µ–π¬ª</h2>
        <div id="six-content" style="margin-top:12px"></div>
      </section>

      <!-- BURNOUT -->
      <section class="card" id="burnout" style="margin-top:16px; display:none">
        <button class="btn btn-ghost" id="burnout-back">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
        <h2>–¢–µ—Å—Ç –Ω–∞ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ (Maslach)</h2>
        <div id="burnout-content" style="margin-top:12px"></div>
      </section>

      <!-- RESULTS -->
      <section class="card" id="results" style="margin-top:16px; display:none">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
        <div id="results-content" style="margin-top:12px"></div>
        <div style="margin-top:12px">
          <button class="btn btn-primary" id="result-to-practice">–ù–∞—á–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É</button>
        </div>
      </section>

      <!-- PRACTICES -->
      <section class="card" id="practices" style="margin-top:16px; display:none">
        <button class="btn btn-ghost" id="practices-back">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
        <h2>–ü—Ä–∞–∫—Ç–∏–∫–∏</h2>
        <p class="muted-block">–í—ã–±–µ—Ä–∏ –ø—Ä–∞–∫—Ç–∏–∫—É –∏ —Å–ª–µ–¥—É–π —à–∞–≥–∞–º –≤ —Å–≤–æ—ë–º —Ç–µ–º–ø–µ.</p>

        <div class="grid-2" style="margin-top:12px">
          <div class="small">
            <strong>üåø –ü–æ–ª–µ –ª—é–±–≤–∏</strong>
            <div class="muted-block" style="margin-top:8px">–ú—è–≥–∫–∞—è 10‚Äì15 –º–∏–Ω—É—Ç–Ω–∞—è –º–µ–¥–∏—Ç–∞—Ü–∏—è</div>
            <div style="margin-top:10px"><button class="btn btn-primary" id="open-love">–û—Ç–∫—Ä—ã—Ç—å</button></div>
          </div>

          <div class="small">
            <strong>üîÅ –ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ</strong>
            <div class="muted-block" style="margin-top:8px">–ü–æ—à–∞–≥–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ —Å —ç–º–æ—Ü–∏–µ–π</div>
            <div style="margin-top:10px"><button class="btn btn-outline" id="open-trans">–û—Ç–∫—Ä—ã—Ç—å</button></div>
          </div>

          <div class="small">
            <strong>‚úçÔ∏è –°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π</strong>
            <div class="muted-block" style="margin-top:8px">–î–æ–∫—É–º–µ–Ω—Ç –Ω–∞ 3 –º–µ—Å—è—Ü–∞</div>
            <div style="margin-top:10px"><button class="btn btn-outline" id="open-agreement">–û—Ç–∫—Ä—ã—Ç—å</button></div>
          </div>

          <div class="small">
            <strong>üìù –î–Ω–µ–≤–Ω–∏–∫</strong>
            <div class="muted-block" style="margin-top:8px">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ + –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –±–æ—Ç–∞</div>
            <div style="margin-top:10px"><button class="btn btn-ghost" id="open-journal">–û—Ç–∫—Ä—ã—Ç—å</button></div>
          </div>
        </div>
      </section>

      <!-- PRACTICE: LOVE -->
      <section class="card" id="practice-love" style="margin-top:16px; display:none">
        <button class="btn btn-ghost" id="love-back">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
        <h2>–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Äî –ü–æ–ª–µ –ª—é–±–≤–∏</h2>
        <p class="muted-block">–ù–∞–π–¥–∏ 10‚Äì15 –º–∏–Ω—É—Ç –≤ —Ç–∏—à–∏–Ω–µ. –ï—Å—Ç—å –∞—É–¥–∏–æ–≤–µ—Ä—Å–∏—è –∏ —Ç–µ–∫—Å—Ç–æ–≤–∞—è.</p>
        <div style="margin-top:12px">
          <button class="btn btn-primary" id="play-love">üéß –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∞—É–¥–∏–æ</button>
          <button class="btn btn-outline" id="show-love-text">üìÑ –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
        </div>

        <div id="love-audio" style="margin-top:12px; display:none">
          <audio controls id="audio-player" style="width:100%">
            <!-- –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –∞—É–¥–∏–æ, –µ—Å–ª–∏ –µ—Å—Ç—å -->
            <source src="audio/love-field.mp3" type="audio/mpeg">
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ.
          </audio>
          <div style="margin-top:10px">
            <button class="btn btn-primary" id="complete-love">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É</button>
          </div>
        </div>

        <div id="love-text" style="margin-top:12px;display:none">
          <div class="small">
            <p class="muted-block">–°—è–¥—å—Ç–µ —É–¥–æ–±–Ω–æ, –∑–∞–∫—Ä–æ–π—Ç–µ –≥–ª–∞–∑–∞, –≤–¥–æ—Ö–Ω–∏—Ç–µ –≥–ª—É–±–æ–∫–æ... (—É–∫–æ—Ä–æ—á–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)</p>
            <div style="margin-top:10px">
              <button class="btn btn-primary" id="complete-love-2">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–∞–∫—Ç–∏–∫—É</button>
            </div>
          </div>
        </div>
      </section>

      <!-- PRACTICE: TRANSFIGURATION -->
      <section class="card" id="practice-trans" style="margin-top:16px;display:none">
        <button class="btn btn-ghost" id="trans-back">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
        <h2>–ü—Ä–∞–∫—Ç–∏–∫–∞ ‚Äî –ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h2>
        <div id="trans-content" style="margin-top:12px"></div>
      </section>

      <!-- PRACTICE: AGREEMENT -->
      <section class="card" id="practice-agreement" style="margin-top:16px;display:none">
        <button class="btn btn-ghost" id="agreement-back">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
        <h2>–°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π</h2>
        <div id="agreement-content" style="margin-top:12px"></div>
      </section>

      <!-- JOURNAL -->
      <section class="card" id="journal" style="margin-top:16px;display:none">
        <button class="btn btn-ghost" id="journal-back">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
        <h2>–î–Ω–µ–≤–Ω–∏–∫</h2>
        <p class="muted-block">–ó–∞–ø–∏—à–∏ —Å–≤–æ–∏ –º—ã—Å–ª–∏ ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ. –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç–∞.</p>
        <div style="margin-top:12px">
          <button class="btn btn-primary" id="journal-prompt">–î–∞—Ç—å –≤–æ–ø—Ä–æ—Å</button>
          <div id="journal-q" style="margin-top:8px; display:none" class="small"></div>
          <textarea id="journal-text" placeholder="–ü–∏—à–∏ —Å—é–¥–∞..."></textarea>
          <div style="margin-top:8px">
            <button class="btn btn-primary" id="save-journal">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ</button>
            <button class="btn btn-outline" id="send-journal">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç–∞</button>
          </div>
        </div>
      </section>

      <footer style="margin-top:18px">
        <div class="muted-block">¬© –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è ¬´–ù–∞–π—Ç–∏ —Å–µ–±—è¬ª ‚Äî –±–µ—Ä–µ–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é</div>
      </footer>
    </main>

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="card">
        <strong>–¢–µ–∫—É—â–µ–µ</strong>
        <div class="muted-block" style="margin-top:8px">–ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</div>

        <div style="margin-top:12px; display:flex; gap:8px; flex-direction:column">
          <button class="btn btn-outline" id="nav-diagnostics">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
          <button class="btn btn-outline" id="nav-practices">–ü—Ä–∞–∫—Ç–∏–∫–∏</button>
          <button class="btn btn-outline" id="nav-journal">–î–Ω–µ–≤–Ω–∏–∫</button>
          <button class="btn btn-outline" id="nav-home">–ì–ª–∞–≤–Ω–∞—è</button>
        </div>

        <div style="margin-top:12px">
          <div class="muted-block">–ü–æ—Å–ª–µ–¥–Ω–µ–µ</div>
          <div style="margin-top:8px">
            <div class="small"><strong id="stat-last-test">‚Äî</strong><div class="muted-block">–ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç</div></div>
            <div class="small" style="margin-top:8px"><strong id="stat-last-practice">‚Äî</strong><div class="muted-block">–ø–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–∞–∫—Ç–∏–∫–∞</div></div>
            <div class="small" style="margin-top:8px"><strong id="stat-last-journal">‚Äî</strong><div class="muted-block">–ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å</div></div>
          </div>
        </div>
      </div>
    </aside>
  </div>

<script>
/* ===========================
   Client-side app logic
   =========================== */
const tg = window.Telegram?.WebApp || null;
if (tg && tg.ready) { try{ tg.ready(); tg.expand(); }catch(e){} }

// Simple SPA show/hide
function show(id){
  document.querySelectorAll('main section.card').forEach(el=>el.style.display='none');
  const el = document.getElementById(id);
  if(el) el.style.display = 'block';
  window.scrollTo({top:0, behavior:'smooth'});
}

// Initial
show('diagnostics-menu');

// Buttons
document.getElementById('btn-start').onclick = () => show('diagnostics-menu');
document.getElementById('btn-features').onclick = () => { document.getElementById('features').style.display='block'; show('features'); };
document.getElementById('btn-book').onclick = () => alert('–ö–Ω–∏–≥–∞: ¬´–ù–∞–π—Ç–∏ —Å–µ–±—è¬ª ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.');

document.getElementById('nav-diagnostics').onclick = ()=> show('diagnostics-menu');
document.getElementById('nav-practices').onclick = ()=> { show('practices'); };
document.getElementById('nav-journal').onclick = ()=> show('journal');
document.getElementById('nav-home').onclick = ()=> show('diagnostics-menu');

// ---------- Six Levels test ----------
const sixQuestions = [
 "–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Å–≤–æ—ë —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ? (—ç–Ω–µ—Ä–≥–∏—è, —Å–æ–Ω, —Ç–µ–ª–µ—Å–Ω–æ–µ –æ—â—É—â–µ–Ω–∏–µ)",
 "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–≤—è–∑—å —Å–æ —Å–≤–æ–∏–º–∏ –±–∞–∑–æ–≤—ã–º–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º–∏? (–µ–¥–∞, –æ—Ç–¥—ã—Ö, –¥–≤–∏–∂–µ–Ω–∏–µ)",
 "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —É–≤–µ—Ä–µ–Ω—ã –≤ —Å–µ–±–µ –∫–∞–∫ –≤ –ª–∏—á–Ω–æ—Å—Ç–∏? (—Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞, –≥—Ä–∞–Ω–∏—Ü—ã)",
 "–ß—É–≤—Å—Ç–≤—É–µ—Ç–µ –ª–∏ –≤—ã –∫–æ–Ω—Ç–∞–∫—Ç —Å —Å–æ–±–æ–π? (–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–≤–æ–∏—Ö –∂–µ–ª–∞–Ω–∏–π, —ç–º–æ—Ü–∏–π)",
 "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã —Å–≤–æ–∏–º–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏? (–±–ª–∏–∑–æ—Å—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∫–∞)",
 "–ï—Å—Ç—å –ª–∏ –≤ –≤–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö –æ—â—É—â–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –¥–æ–≤–µ—Ä–∏—è?",
 "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–º—ã—Å–ª –≤ —Å–≤–æ–µ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?",
 "–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –æ—â—É—â–µ–Ω–∏–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–±–æ—Ç–µ?",
 "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã –∂–∏–≤—ë—Ç–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å–≤–æ–∏–º–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏?",
 "–ß—É–≤—Å—Ç–≤—É–µ—Ç–µ –ª–∏ –≤—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Å–ª–æ–≤–æ–º –∏ –¥–µ–ª–æ–º?",
 "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã –æ—â—É—â–∞–µ—Ç–µ —Å–≤—è–∑—å —Å —á–µ–º-—Ç–æ –±–æ–ª—å—à–∏–º, —á–µ–º –≤—ã —Å–∞–º–∏? (–¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å, –ø—Ä–∏—Ä–æ–¥–∞, –∏—Å–∫—É—Å—Å—Ç–≤–æ)",
 "–ï—Å—Ç—å –ª–∏ –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏ –æ—â—É—â–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è?"
];

let sixAnswers = [];
function renderSix(index=0){
  const el = document.getElementById('six-content');
  if(index >= sixQuestions.length){
    calcSix();
    return;
  }
  const progress = Math.round((index / sixQuestions.length) * 100);
  el.innerHTML = `
    <div class="progress"><i style="width:${progress}%"></i></div>
    <div class="question"><strong>–í–æ–ø—Ä–æ—Å ${index+1}/${sixQuestions.length}</strong><div style="margin-top:8px">${escapeHtml(sixQuestions[index])}</div></div>
    <div class="scores">${Array.from({length:10}, (_,i)=>i+1).map(n=>`<button class="score" data-val="${n}">${n}</button>`).join('')}</div>
  `;
  el.querySelectorAll('.score').forEach(btn=>{
    btn.onclick = ()=> {
      sixAnswers[index] = Number(btn.dataset.val);
      renderSix(index+1);
    }
  });
}

document.getElementById('start-6levels').onclick = ()=> { sixAnswers = []; show('six-levels'); renderSix(0); };
document.getElementById('six-back').onclick = ()=> { show('diagnostics-menu'); };

// Calculate result
function calcSix(){
  const safe = sixAnswers.map(v=>Number(v)||0);
  const avg = (a,b)=>((safe[a]||0)+(safe[b]||0))/2;
  const levels = {
    physical: avg(0,1),
    personal: avg(2,3),
    interpersonal: avg(4,5),
    professional: avg(6,7),
    principled: avg(8,9),
    spiritual: avg(10,11)
  };
  const names = { physical:'–§–∏–∑–∏—á–µ—Å–∫–∏–π', personal:'–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π', interpersonal:'–ú–µ–∂–ª–∏—á–Ω–æ—Å—Ç–Ω—ã–π', professional:'–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π', principled:'–ü—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω—ã–π', spiritual:'–î—É—Ö–æ–≤–Ω—ã–π' };
  const strengths = Object.entries(levels).filter(([k,v])=>v>=7);
  const tensions = Object.entries(levels).filter(([k,v])=>v>=4 && v<7);
  const critical = Object.entries(levels).filter(([k,v])=>v<4);

  let html = '';
  if(strengths.length) html += `<div class="small"><strong>üü¢ –°–∏–ª—å–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏:</strong><div class="muted-block">${strengths.map(([k,v])=>`${names[k]} (${Math.round(v)}/10)`).join(', ')}</div></div>`;
  if(tensions.length) html += `<div class="small" style="margin-top:8px"><strong>üü° –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ:</strong><div class="muted-block">${tensions.map(([k,v])=>`${names[k]} (${Math.round(v)}/10)`).join(', ')}</div></div>`;
  if(critical.length) html += `<div class="small" style="margin-top:8px"><strong>üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏:</strong><div class="muted-block">${critical.map(([k,v])=>`${names[k]} (${Math.round(v)}/10)`).join(', ')}</div></div>`;

  html += `<div style="margin-top:12px" class="small"><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</strong><div class="muted-block">–ü–µ—Ä–µ—á–∏—Ç–∞–π—Ç–µ –≥–ª–∞–≤—ã 10,12,19. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞: ¬´–ü–æ–ª–µ –ª—é–±–≤–∏¬ª.</div></div>`;
  document.getElementById('results-content').innerHTML = html;
  document.getElementById('stat-last-test').textContent = '6 —É—Ä–æ–≤–Ω–µ–π';
  show('results');

  // send to Telegram (optional)
  sendToTelegram({action:'test_completed', test:'six_levels', result: levels});
}

// ---------- Burnout (Maslach) ----------
const burnoutQuestions = [
 "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –æ–ø—É—Å—Ç–æ—à–µ–Ω–Ω—ã–º(–æ–π) –Ω–∞ —Ä–∞–±–æ—Ç–µ.",
 "–ö –∫–æ–Ω—Ü—É —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è —è —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –∫–∞–∫ ¬´–≤—ã–∂–∞—Ç—ã–π –ª–∏–º–æ–Ω¬ª.",
 "–Ø —Å—Ç–∞–ª(–∞) –±–æ–ª–µ–µ —Ü–∏–Ω–∏—á–Ω—ã–º(–æ–π) –∏–ª–∏ –±–µ–∑—Ä–∞–∑–ª–∏—á–Ω—ã–º(–æ–π) –∫ –¥—Ä—É–≥–∏–º.",
 "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –º–æ–∏ —É—Å–∏–ª–∏—è –Ω–µ –ø—Ä–∏–Ω–æ—Å—è—Ç –∑–Ω–∞—á–∏–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.",
 "–Ø —Å —Ç—Ä—É–¥–æ–º –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É—é—Å—å –Ω–∞ –∑–∞–¥–∞—á–∞—Ö.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.",
 "–ú–µ–Ω—è —Ä–∞–∑–¥—Ä–∞–∂–∞—é—Ç –º–µ–ª–∫–∏–µ –Ω–µ—É–¥–∞—á–∏ –∏ –ø–æ–º–µ—Ö–∏.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —É—Å—Ç–∞–≤—à–∏–º(–µ–π) —É–∂–µ —Å —É—Ç—Ä–∞.",
 "–ú–Ω–µ —Å–ª–æ–∂–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –¥–≤–∏–≥–∞—é—Å—å –ø–æ –∑–∞–º–∫–Ω—É—Ç–æ–º—É –∫—Ä—É–≥—É.",
 "–Ø —Å—Ç–∞–ª(–∞) –º–µ–Ω–µ–µ —Ç–µ—Ä–ø–∏–º—ã–º(–æ–π) –∫ –∫–æ–ª–ª–µ–≥–∞–º –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞–º.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –º–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–µ –∑–∞–º–µ—á–∞—é—Ç.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ '—Å–≥–æ—Ä–∞—é'.",
 "–ú–Ω–µ –≤—Å—ë —Ç—Ä—É–¥–Ω–µ–µ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º –Ω–∞ —Ä–∞–±–æ—Ç–µ.",
 "–Ø —Å—Ç–∞–ª(–∞) –±–æ–ª–µ–µ —Ö–æ–ª–æ–¥–Ω—ã–º(–æ–π) –≤ –æ–±—â–µ–Ω–∏–∏.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ —Ä–∞–±–æ—Ç–∞ '–≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç' –∏–∑ –º–µ–Ω—è –≤—Å—ë.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Å—å —Å –æ–±—ä—ë–º–æ–º —Ä–∞–±–æ—Ç—ã.",
 "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ —è –Ω–µ –¥–æ—Å—Ç–∏–≥–∞—é —Å–≤–æ–∏—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –º–æ–∏ —É—Å–∏–ª–∏—è –Ω–∞–ø—Ä–∞—Å–Ω—ã.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ.",
 "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –º–æ–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ —É—Ö—É–¥—à–∞—é—Ç—Å—è.",
 "–Ø —Å—Ç–∞–ª(–∞) –±–æ–ª–µ–µ —Ü–∏–Ω–∏—á–Ω—ã–º(–æ–π) –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ."
];

let burnoutAnswers = [];
function renderBurnout(index=0){
  const el = document.getElementById('burnout-content');
  if(index >= burnoutQuestions.length){ calcBurnout(); return; }
  const progress = Math.round((index / burnoutQuestions.length) * 100);
  el.innerHTML = `
    <div class="progress"><i style="width:${progress}%"></i></div>
    <div class="question"><strong>${index+1} / ${burnoutQuestions.length}</strong><div style="margin-top:8px">${escapeHtml(burnoutQuestions[index])}</div></div>
    <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:8px; margin-top:12px">
      <button class="btn btn-ghost" data-val="0">–ù–∏–∫–æ–≥–¥–∞</button>
      <button class="btn btn-ghost" data-val="1">–û—á–µ–Ω—å —Ä–µ–¥–∫–æ</button>
      <button class="btn btn-ghost" data-val="2">–†–µ–¥–∫–æ</button>
      <button class="btn btn-ghost" data-val="3">–ò–Ω–æ–≥–¥–∞</button>
      <button class="btn btn-ghost" data-val="4">–ß–∞—Å—Ç–æ</button>
      <button class="btn btn-ghost" data-val="5">–û—á–µ–Ω—å —á–∞—Å—Ç–æ</button>
      <button class="btn btn-ghost" data-val="6">–ö–∞–∂–¥—ã–π –¥–µ–Ω—å</button>
    </div>
  `;
  el.querySelectorAll('button[data-val]').forEach(b=>{
    b.onclick = ()=>{ burnoutAnswers[index]=Number(b.dataset.val); renderBurnout(index+1); }
  });
}

document.getElementById('start-burnout').onclick = ()=> { burnoutAnswers=[]; show('burnout'); renderBurnout(0); };
document.getElementById('burnout-back').onclick = ()=> show('diagnostics-menu');

function calcBurnout(){
  const a = burnoutAnswers.map(v=>Number(v)||0);
  const EI_q=[0,1,2,5,7,12,13,15,19];
  const DP_q=[4,9,10,14,21];
  const RPD_q=[3,6,8,11,16,17,18,20];
  const sum = (arr)=>arr.reduce((s,i)=>s+(a[i]||0),0);
  const EI = sum(EI_q), DP = sum(DP_q), RPD = sum(RPD_q);
  const getLevel=(score,low,med)=> score>med ? '–í—ã—Å–æ–∫–∏–π' : (score>=low ? '–°—Ä–µ–¥–Ω–∏–π' : '–ù–∏–∑–∫–∏–π');
  const eiL = getLevel(EI,17,26), dpL = getLevel(DP,6,9), rpdL = getLevel(RPD,32,39);
  const html = `
    <div class="small"><strong>üî• –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ:</strong> <span class="muted-block">${eiL}</span></div>
    <div class="small" style="margin-top:8px"><strong>üë§ –î–µ–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:</strong> <span class="muted-block">${dpL}</span></div>
    <div class="small" style="margin-top:8px"><strong>üìâ –ß—É–≤—Å—Ç–≤–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</strong> <span class="muted-block">${rpdL}</span></div>
    <div class="small" style="margin-top:12px"><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><div class="muted-block">–°–Ω–∏–∑—å—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ–±–µ, –æ—Ç–¥—ã—Ö–∞–π—Ç–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º ‚Äî ¬´–ü–æ–ª–µ –ª—é–±–≤–∏¬ª.</div></div>
  `;
  document.getElementById('results-content').innerHTML = html;
  document.getElementById('stat-last-test').textContent = '–í—ã–≥–æ—Ä–∞–Ω–∏–µ';
  show('results');

  sendToTelegram({action:'test_completed', test:'burnout', result:{EI,DP,RPD}});
}

// ---------- Practices logic ----------
document.getElementById('to-practices').onclick = ()=> show('practices');
document.getElementById('practices-back').onclick = ()=> show('diagnostics-menu');

// Love practice
document.getElementById('open-love').onclick = ()=> show('practice-love');
document.getElementById('love-back').onclick = ()=> show('practices');
document.getElementById('play-love').onclick = ()=> {
  document.getElementById('love-audio').style.display='block';
  sendToTelegram({action:'practice_started', practice:'love-field'});
};
document.getElementById('show-love-text').onclick = ()=> document.getElementById('love-text').style.display='block';
document.getElementById('complete-love').onclick = ()=> completePractice('love-field');
document.getElementById('complete-love-2').onclick = ()=> completePractice('love-field');

function completePractice(name){
  document.getElementById('stat-last-practice').textContent = name;
  alert('–ü—Ä–∞–∫—Ç–∏–∫–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è. –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞.');
  sendToTelegram({action:'practice_completed', practice:name});
  show('practices');
}

// Transfiguration (steps)
const transSteps = [
  "–°—è–¥—å —É–¥–æ–±–Ω–æ, –∑–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞, —Å–¥–µ–ª–∞–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–ª—É–±–æ–∫–∏—Ö –≤–¥–æ—Ö–æ–≤. –í–æ–π–¥–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ü–æ–ª—è –õ—é–±–≤–∏.",
  "–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Å—è –Ω–∞ —á—É–≤—Å—Ç–≤–µ, —Å –∫–æ—Ç–æ—Ä—ã–º —Ö–æ—á–µ—à—å –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å. –ù–∞–∑–æ–≤–∏ –µ–≥–æ –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º.",
  "–ù–∞–π–¥–∏ —ç—Ç–æ —á—É–≤—Å—Ç–≤–æ –≤ —Ç–µ–ª–µ. –ì–¥–µ –æ–Ω–æ –∂–∏–≤—ë—Ç? –û–ø–∏—à–∏.",
  "–û–±—Ä–∞—Ç–∏—Å—å –∫ —ç—Ç–æ–º—É –æ–±—Ä–∞–∑—É: '–Ø —Ç–µ–±—è –≤–∏–∂—É'. –°–ø—Ä–æ—Å–∏: '–î–ª—è —á–µ–≥–æ —Ç—ã –∑–¥–µ—Å—å?'. –ó–∞–ø–∏—à–∏ –æ—Ç–≤–µ—Ç.",
  "–ü–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏ —á—É–≤—Å—Ç–≤–æ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –µ–º—É –Ω–æ–≤—É—é —Ä–æ–ª—å ‚Äî –±—ã—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º —Å–∏–ª—ã.",
  "–ú–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è. –ó–∞–ø–∏—à–∏, –∫–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å."
];
let transIdx = 0;

document.getElementById('open-trans').onclick = ()=> { transIdx=0; renderTrans(); show('practice-trans'); }
document.getElementById('trans-back').onclick = ()=> show('practices');

function renderTrans(){
  const el = document.getElementById('trans-content');
  if(transIdx >= transSteps.length){
    el.innerHTML = `<div class="small"><strong>–ü—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</strong><div class="muted-block">–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É —Ä–∞–±–æ—Ç—É.</div><div style="margin-top:8px"><button class="btn btn-primary" id="save-trans">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è</button></div></div>`;
    document.getElementById('save-trans').onclick = ()=> { sendToTelegram({action:'practice_completed', practice:'transfiguration'}); document.getElementById('stat-last-practice').textContent='transfiguration'; show('practices'); };
    return;
  }
  el.innerHTML = `
    <div class="steps">${transSteps.map((_,i)=>`<div class="dot ${i===transIdx?'active':''}"></div>`).join('')}</div>
    <div class="small"><strong>–®–∞–≥ ${transIdx+1} –∏–∑ ${transSteps.length}</strong><div class="muted-block" style="margin-top:8px">${escapeHtml(transSteps[transIdx])}</div>
      <textarea id="trans-answer" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∫–ª–∏–∫..."></textarea>
      <div style="margin-top:8px"><button class="btn btn-primary" id="trans-next">–î–∞–ª–µ–µ</button></div>
    </div>
  `;
  document.getElementById('trans-next').onclick = ()=>{
    const text = document.getElementById('trans-answer').value.trim();
    if(!text){ alert('–ó–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.'); return; }
    // persist to local storage
    const saved = JSON.parse(localStorage.getItem('trans_notes')||'[]');
    saved.push({step:transIdx+1, text, ts:Date.now()});
    localStorage.setItem('trans_notes', JSON.stringify(saved));
    sendToTelegram({action:'transformation_step', step:transIdx+1, note:text});
    transIdx++; renderTrans();
  };
}

// Agreement
let agreementState = {};
document.getElementById('open-agreement').onclick = ()=> { agreementState={}; agreementStep=0; showAgreement(); show('practice-agreement'); }
document.getElementById('agreement-back').onclick = ()=> show('practices');

const agreementQuestions = [
  "–ö–∞–∫–æ–µ –æ–¥–Ω–æ –≥–ª–∞–≤–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ç—ã —Ö–æ—á–µ—à—å —Ä–∞–∑–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–∏–µ 3 –º–µ—Å—è—Ü–∞?",
  "–ù–∞–ø–∏—à–∏ 3 –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç —Ä–∞–∑–≤–∏—Ç—å —ç—Ç–æ –∫–∞—á–µ—Å—Ç–≤–æ.",
  "–ö–∞–∫–∏–µ 1‚Äì2 —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è —Ç—ã –±—É–¥–µ—à—å —Å–æ–≤–µ—Ä—à–∞—Ç—å?",
  "–û—Ç –∫–∞–∫–æ–π –æ–¥–Ω–æ–π —Ä–∞–∑—Ä—É—à–∞—é—â–µ–π –ø—Ä–∏–≤—ã—á–∫–∏ —Ç—ã –≥–æ—Ç–æ–≤ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –Ω–∞ —ç—Ç–æ –≤—Ä–µ–º—è?"
];
let agreementStep = 0;
function showAgreement(){
  const el = document.getElementById('agreement-content');
  if(agreementStep >= agreementQuestions.length){
    // render agreement doc
    const today = new Date();
    const end = new Date(); end.setMonth(end.getMonth()+3);
    const fmt = d=>d.toLocaleDateString();
    const html = `
      <div class="small"><strong>–ú–æ—ë —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ (${fmt(today)} ‚Äî ${fmt(end)})</strong>
        <div class="muted-block" style="margin-top:8px"><strong>–ö–∞—á–µ—Å—Ç–≤–æ:</strong> ${escapeHtml(agreementState.step1||'‚Äî')}</div>
        <div class="muted-block" style="margin-top:6px"><strong>–ü—Ä–∏–Ω—Ü–∏–ø—ã:</strong> ${escapeHtml(agreementState.step2||'‚Äî')}</div>
        <div class="muted-block" style="margin-top:6px"><strong>–ü—Ä–∞–∫—Ç–∏–∫–∏:</strong> ${escapeHtml(agreementState.step3||'‚Äî')}</div>
        <div class="muted-block" style="margin-top:6px"><strong>–û—Ç–∫–∞–∑—ã–≤–∞—é—Å—å:</strong> ${escapeHtml(agreementState.step4||'‚Äî')}</div>
        <div style="margin-top:8px"><button class="btn btn-primary" id="save-agreement">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å</button></div>
      </div>
    `;
    el.innerHTML = html;
    document.getElementById('save-agreement').onclick = ()=>{
      localStorage.setItem('agreement', JSON.stringify(agreementState));
      sendToTelegram({action:'agreement_created', agreement:agreementState});
      document.getElementById('stat-last-practice').textContent = 'agreement';
      alert('–°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ.');
      show('practices');
    };
    return;
  }
  el.innerHTML = `
    <div class="small"><strong>–®–∞–≥ ${agreementStep+1}</strong><div class="muted-block" style="margin-top:8px">${escapeHtml(agreementQuestions[agreementStep])}</div>
      <textarea id="agreement-answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."></textarea>
      <div style="margin-top:8px"><button class="btn btn-primary" id="agreement-next">–î–∞–ª–µ–µ</button></div>
    </div>
  `;
  document.getElementById('agreement-next').onclick = ()=>{
    const v = document.getElementById('agreement-answer').value.trim();
    if(!v){ alert('–ó–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç.'); return; }
    agreementState[`step${agreementStep+1}`] = v;
    agreementStep++;
    showAgreement();
  };
}

// Journal
const journalQs = [
  "–ß—Ç–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –º–æ–∂–µ—Ç –¥–∞—Ç—å –º–Ω–µ —Ö–æ—Ç—å –∫–∞–ø–ª—é —Ç–µ–ø–ª–∞?",
  "–ö–∞–∫–∞—è —á–∞—Å—Ç—å –º–µ–Ω—è –ø—Ä–æ—Å–∏—Ç –≤–Ω–∏–º–∞–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è?",
  "–ß—Ç–æ —è –º–æ–≥—É –ø—Ä–æ—Å—Ç–∏—Ç—å —Å–µ–±–µ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç?",
  "–ì–¥–µ —è —á—É–≤—Å—Ç–≤—É—é –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ? –ß—Ç–æ –æ–Ω–æ —Ö–æ—á–µ—Ç —Å–∫–∞–∑–∞—Ç—å?",
  "–ö–∞–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —è —Ö–æ—á—É –ø—Ä–æ—è–≤–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è?"
];
document.getElementById('journal-prompt').onclick = ()=>{
  const q = journalQs[Math.floor(Math.random()*journalQs.length)];
  const el = document.getElementById('journal-q'); el.style.display='block'; el.innerHTML=`<strong>${escapeHtml(q)}</strong>`;
};
document.getElementById('open-journal').onclick = ()=> show('journal');
document.getElementById('journal-back').onclick = ()=> show('practices');

document.getElementById('save-journal').onclick = ()=>{
  const t = document.getElementById('journal-text').value.trim();
  if(!t){ alert('–ù–∞–ø–∏—à–∏—Ç–µ —Ö–æ—Ç—è –±—ã –ø–∞—Ä—É —Å—Ç—Ä–æ–∫.'); return; }
  const saved = JSON.parse(localStorage.getItem('journal')||'[]');
  saved.push({text:t, ts:Date.now()});
  localStorage.setItem('journal', JSON.stringify(saved));
  document.getElementById('stat-last-journal').textContent = new Date().toLocaleString();
  alert('–ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ.');
  document.getElementById('journal-text').value='';
};

document.getElementById('send-journal').onclick = ()=>{
  const t = document.getElementById('journal-text').value.trim();
  if(!t){ alert('–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π'); return; }
  sendToTelegram({action:'journal_save', text:t});
  document.getElementById('journal-text').value='';
  document.getElementById('stat-last-journal').textContent = new Date().toLocaleString();
  alert('–ó–∞–ø–∏—Å–∞–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–æ—Ç–∞.');
};

// Result -> recommended practice
document.getElementById('result-to-practice').onclick = ()=> {
  // Simple heuristic: always recommend love-field
  show('practice-love');
  sendToTelegram({action:'navigate', to:'love-field', reason:'recommendation'});
};

// Utilities
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[ch]); }

function sendToTelegram(obj){
  // Send structured data to Telegram backend via WebApp.sendData if available
  try{
    const payload = JSON.stringify(obj);
    if(window.Telegram && Telegram.WebApp && Telegram.WebApp.sendData){
      Telegram.WebApp.sendData(payload);
    } else {
      console.log("Telegram sendData not available. Payload:", payload);
    }
  } catch(e){
    console.warn("Failed to send to Telegram", e);
  }
}
</script>
</body>
</html>
