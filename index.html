<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ù–∞–π—Ç–∏ —Å–µ–±—è ‚Äî –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è</title>
<script src="https://telegram.org/js/telegram-web-app.js" defer></script>

<!-- –ò–Ω—Ç–µ—Ä -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  /* =========================
     Theme tokens & reset
     ========================= */
  :root{
    --bg-1: #f7f9fb;
    --bg-2: #ffffff;
    --muted: #6b7280;
    --accent-1: #5b6df6;
    --accent-2: #8b5cf6;
    --glass: rgba(255,255,255,0.6);
    --card-radius: 14px;
    --soft-shadow: 0 6px 24px rgba(17,24,39,0.06);
    --glass-shadow: 0 10px 30px rgba(99,102,241,0.08);
    --success: #16a34a;
    --danger: #ef4444;
    --surface: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
  }

  /* Reset */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#eef2ff 0%, #f7fbff 100%);
    color:#0f172a;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.5;
    padding:24px;
  }

  /* Container layout */
  .app {
    max-width:1100px;
    margin:0 auto;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:20px;
    align-items:start;
  }

  @media (max-width: 980px){
    .app{ grid-template-columns: 1fr; padding: 16px; }
  }

  /* Left column (main screens) */
  .main {
    min-height: 80vh;
  }

  /* Right column (sidebar) */
  .sidebar {
    position:sticky;
    top:24px;
    align-self:start;
  }

  /* Card */
  .card{
    background:var(--surface);
    border-radius:var(--card-radius);
    padding:20px;
    box-shadow:var(--soft-shadow);
    border: 1px solid rgba(15, 23, 42, 0.03);
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .card:hover{ transform: translateY(-4px); box-shadow: 0 14px 40px rgba(2,6,23,0.08); }

  /* Header / hero */
  .hero{
    display:flex;
    gap:18px;
    align-items:center;
  }
  .logo {
    width:68px;
    height:68px;
    border-radius:14px;
    display:flex;
    align-items:center;
    justify-content:center;
    background: linear-gradient(135deg,var(--accent-1),var(--accent-2));
    color:white;
    font-weight:700;
    font-size:22px;
    box-shadow: var(--glass-shadow);
    flex-shrink:0;
  }
  .hero h1{
    font-size:clamp(18px, 2.6vw, 26px);
    margin:0;
    letter-spacing:-0.02em;
  }
  .hero p{ margin:4px 0 0; color:var(--muted); font-size:14px; }

  /* Controls */
  .controls { display:flex; gap:12px; margin-top:16px; flex-wrap:wrap; }
  .btn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 14px;
    border-radius:12px;
    border:none;
    cursor:pointer;
    font-weight:600;
    font-size:14px;
    transition: transform .12s ease, box-shadow .12s ease;
  }
  .btn:active{ transform: translateY(1px) }
  .btn-primary{
    color:#fff;
    background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
    box-shadow: 0 8px 30px rgba(91,109,246,0.12);
  }
  .btn-ghost{
    background:transparent;
    border:1px solid rgba(15,23,42,0.06);
    color:var(--muted);
  }
  .btn-outline{
    background:transparent;
    border:1px solid rgba(91,109,246,0.14);
    color:var(--accent-1);
    font-weight:600;
  }

  /* Screens system */
  .screen { display:none; animation:screenIn .28s ease both; }
  .screen.active{ display:block; }
  @keyframes screenIn { from {opacity:0; transform: translateY(8px)} to {opacity:1; transform:none} }

  /* Progress bar */
  .progress {
    height:10px;
    background:linear-gradient(90deg,#eef2ff,#fcfbff);
    border-radius:999px;
    overflow:hidden;
    margin:14px 0 18px;
    border:1px solid rgba(15,23,42,0.03);
  }
  .progress > i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); transition:width .45s cubic-bezier(.2,.9,.2,1) }

  /* Question card */
  .question {
    background: linear-gradient(180deg, #ffffff, #fbfdff);
    padding:18px;
    border-radius:12px;
    border-left:4px solid rgba(91,109,246,0.14);
  }
  .question p{margin:0 0 8px; font-weight:600}

  /* Score buttons */
  .score-row{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:16px; }
  .score {
    width:48px;height:48px;border-radius:10px;border:1px solid rgba(15,23,42,0.04); background:white;
    display:inline-grid;place-items:center; font-weight:700; cursor:pointer; box-shadow: 0 6px 14px rgba(2,6,23,0.04);
    transition: transform .12s ease, box-shadow .12s ease, border-color .12s;
  }
  .score:hover{ transform: translateY(-4px); border-color: rgba(91,109,246,0.12); box-shadow: 0 10px 30px rgba(91,109,246,0.06); }
  .score.active { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:white; border:none; box-shadow: 0 12px 36px rgba(91,109,246,0.12); }

  /* Step indicator */
  .steps { display:flex; gap:8px; justify-content:center; margin:14px 0; }
  .dot { width:10px;height:10px;border-radius:999px;background:#e6eefc; }
  .dot.active{ background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); box-shadow: 0 6px 18px rgba(91,109,246,0.12) }

  /* Practice and journal */
  .practice-row{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:12px; margin-top:18px; }
  .card-small{ padding:14px; border-radius:12px; background: linear-gradient(180deg,#fff,#fcfeff); border:1px solid rgba(15,23,42,0.03); }

  textarea.journal {
    width:100%; min-height:120px; resize:vertical; padding:14px; border-radius:10px; border:1px solid rgba(15,23,42,0.05);
    font-family:inherit; font-size:15px; line-height:1.5; background:transparent;
  }
  textarea.journal:focus{ outline: none; box-shadow: 0 8px 30px rgba(91,109,246,0.06); border-color: rgba(91,109,246,0.18) }

  /* Result badges */
  .badge { padding:10px 12px; border-radius:10px; display:inline-flex; gap:10px; align-items:center; font-weight:700; }
  .badge.good{ color:var(--success); background: rgba(22,163,74,0.06); }
  .badge.warn{ color:#b45309; background: rgba(190,148,0,0.06); }
  .badge.danger{ color:var(--danger); background: rgba(239,68,68,0.06); }

  /* Sidebar */
  .sidebar .card{ position:relative; overflow:visible; }
  .side-stats { display:flex; gap:12px; flex-direction:column; }
  .stat { display:flex; justify-content:space-between; align-items:center; padding:10px 12px; border-radius:10px; background:#fff; border:1px solid rgba(15,23,42,0.03); }
  .stat strong{ font-size:18px }
  .stat span{ color:var(--muted) }

  /* Footer small */
  .muted { color:var(--muted); font-size:13px; margin-top:12px; }

  /* Accessibility: focus */
  :focus{ outline: 3px solid rgba(91,109,246,0.12); outline-offset:2px; border-radius:8px; }

</style>
</head>
<body>

<div class="app" id="app">
  <main class="main">

    <!-- Loading / Onboarding (kept IDs for JS compatibility) -->
    <section id="loading-screen" class="screen active card" aria-live="polite">
      <div class="hero">
        <div class="logo">–ùC</div>
        <div>
          <h1>–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–≤–æ—ë –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</h1>
          <p>–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ. –ë–µ–∑ –æ—Ü–µ–Ω–æ–∫. –ü—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω—ë–º –≤–º–µ—Å—Ç–µ.</p>
        </div>
      </div>

      <div class="controls" style="margin-top:18px;">
        <button class="btn btn-primary" onclick="showScreen('onboarding-screen')">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <button class="btn btn-ghost" onclick="showScreen('support-screen')">–ü–æ–º–æ—â—å</button>
      </div>
    </section>

    <section id="onboarding-screen" class="screen card" aria-hidden="true">
      <div class="hero">
        <div class="logo">–ùC</div>
        <div>
          <h1>–ü—Ä–∏–≤–µ—Ç ‚Äî –¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú–∞—Å—Ç–µ—Ä—Å–∫—É—é</h1>
          <p>–ö–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, —á–µ—Å—Ç–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –º—è–≥–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–º–æ–≥–∞—é—Ç.</p>
        </div>
      </div>

      <div class="controls" aria-hidden="false">
        <button class="btn btn-primary" onclick="showScreen('diagnostics-menu')">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å –ø—É—Ç—å</button>
        <button class="btn btn-outline" onclick="showScreen('features-screen')">–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏</button>
        <button class="btn btn-ghost" onclick="showScreen('book-screen')">–û –∫–Ω–∏–≥–µ</button>
      </div>

      <div style="margin-top:18px" class="muted">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω ‚Äî –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏ WebApp</div>
    </section>

    <section id="features-screen" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('onboarding-screen')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–ß—Ç–æ —É–º–µ–µ—Ç –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è</h2>
      <p class="muted">–ö–æ—Ä–æ—Ç–∫–æ: –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞, –ø—Ä–∞–∫—Ç–∏–∫–∏, –¥–Ω–µ–≤–Ω–∏–∫ –∏ –º—è–≥–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞.</p>

      <div class="practice-row" style="margin-top:12px">
        <div class="card-small">
          <strong>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ¬´6 —É—Ä–æ–≤–Ω–µ–π¬ª</strong>
          <div class="muted">–≠–∫—Å–ø—Ä–µ—Å—Å-–æ—Ü–µ–Ω–∫–∞ 12 –≤–æ–ø—Ä–æ—Å–æ–≤</div>
        </div>
        <div class="card-small">
          <strong>–¢–µ—Å—Ç –Ω–∞ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ</strong>
          <div class="muted">–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–ø—Ä–æ—Å–Ω–∏–∫ –ú–∞—Å–ª–∞—á–∞</div>
        </div>
        <div class="card-small">
          <strong>–ü—Ä–∞–∫—Ç–∏–∫–∏</strong>
          <div class="muted">¬´–ü–æ–ª–µ –ª—é–±–≤–∏¬ª, ¬´–ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ¬ª, ¬´–°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π¬ª</div>
        </div>
        <div class="card-small">
          <strong>–î–Ω–µ–≤–Ω–∏–∫</strong>
          <div class="muted">–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —à–∞–±–ª–æ–Ω Google Docs</div>
        </div>
      </div>

      <div class="controls" style="margin-top:16px">
        <button class="btn btn-primary" onclick="showScreen('diagnostics-menu')">–ù–∞—á–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
        <button class="btn btn-outline" onclick="showScreen('practices-menu')">–ö –ø—Ä–∞–∫—Ç–∏–∫–∞–º</button>
      </div>
    </section>

    <section id="book-screen" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('onboarding-screen')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–û –∫–Ω–∏–≥–µ ¬´–ù–∞–π—Ç–∏ —Å–µ–±—è¬ª</h2>
      <p class="muted">–ñ–∏–≤–∞—è –∫–∞—Ä—Ç–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ ‚Äî –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Å–º—ã—Å–ª–∞.</p>

      <div style="display:flex; gap:12px; margin-top:14px; flex-wrap:wrap;">
        <div class="card-small"><strong>6 —É—Ä–æ–≤–Ω–µ–π</strong><div class="muted">–ú–æ–¥–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏</div></div>
        <div class="card-small"><strong>20+ –ø—Ä–∞–∫—Ç–∏–∫</strong><div class="muted">–ü—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–∑–Ω–æ–π –≥–ª—É–±–∏–Ω—ã</div></div>
        <div class="card-small"><strong>–†–µ—Å—É—Ä—Å–Ω–æ—Å—Ç—å</strong><div class="muted">–ü—Ä–∞–≥–º–∞—Ç–∏—á–Ω—ã–π —Ñ–æ–∫—É—Å –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏</div></div>
      </div>

      <div class="controls" style="margin-top:16px">
        <button class="btn btn-outline" onclick="window.open('https://www.ozon.ru/product/nayti-sebya-...', '_blank')">üõí –ö—É–ø–∏—Ç—å</button>
        <button class="btn btn-primary" onclick="showScreen('diagnostics-menu')">–ù–∞—á–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
      </div>
    </section>

    <section id="support-screen" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('onboarding-screen')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
      <p class="muted">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–º–æ—â—å –∏–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∞.</p>

      <div style="display:flex; flex-direction:column; gap:10px; margin-top:12px">
        <button class="btn btn-outline" onclick="reportBug()">–°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ</button>
        <button class="btn btn-outline" onclick="window.open('https://t.me/artyom_grafov','_blank')">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –∞–≤—Ç–æ—Ä–æ–º</button>
        <button class="btn btn-outline" onclick="window.open('https://t.me/kanal_masterskaya','_blank')">–¢—Ä–µ–Ω–∏–Ω–≥–∏</button>
      </div>
    </section>

    <!-- Diagnostics menu -->
    <section id="diagnostics-menu" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('onboarding-screen')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–ù–∞—á–∞—Ç—å –ø—É—Ç—å</h2>
      <p class="muted">–ü–æ–Ω–∏–º–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ. –í—ã–±–µ—Ä–∏ —Ç–µ—Å—Ç.</p>

      <div class="practice-row" style="margin-top:16px">
        <div class="card-small">
          <strong>–≠–∫—Å–ø—Ä–µ—Å—Å: ¬´–ú–æ–∏ 6 —É—Ä–æ–≤–Ω–µ–π¬ª</strong>
          <div class="muted" style="margin-top:8px">~5 –º–∏–Ω—É—Ç, 12 –≤–æ–ø—Ä–æ—Å–æ–≤</div>
          <div style="margin-top:12px"><button class="btn btn-primary" onclick="startSixLevelsTest()">–ù–∞—á–∞—Ç—å</button></div>
        </div>
        <div class="card-small">
          <strong>–¢–µ—Å—Ç –Ω–∞ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ (MBI)</strong>
          <div class="muted" style="margin-top:8px">22 –≤–æ–ø—Ä–æ—Å–∞</div>
          <div style="margin-top:12px"><button class="btn btn-outline" onclick="startBurnoutTest()">–ù–∞—á–∞—Ç—å</button></div>
        </div>
      </div>
    </section>

    <!-- Six levels test -->
    <section id="six-levels-screen" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('diagnostics-menu')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ¬´–ú–æ–∏ 6 —É—Ä–æ–≤–Ω–µ–π¬ª</h2>
      <p class="muted">–û—Ç–≤–µ—Ç—å —á–µ—Å—Ç–Ω–æ ‚Äî –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.</p>

      <div id="six-levels-content" style="margin-top:12px"></div>
    </section>

    <!-- Burnout -->
    <section id="burnout-screen" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('diagnostics-menu')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–¢–µ—Å—Ç –Ω–∞ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ</h2>
      <p class="muted">–ê–¥–∞–ø—Ç–∞—Ü–∏—è –æ–ø—Ä–æ—Å–Ω–∏–∫–∞ –ú–∞—Å–ª–∞—á–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏.</p>

      <div id="burnout-content" style="margin-top:12px"></div>
    </section>

    <!-- Results -->
    <section id="six-levels-result" class="screen card" aria-hidden="true">
      <h2>–¢–≤–æ—è –∫–∞—Ä—Ç–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h2>
      <div id="six-levels-result-content" style="margin-top:12px"></div>
      <div style="margin-top:14px" class="controls">
        <button class="btn btn-primary" onclick="startPractice('love-field')">–ù–∞—á–∞—Ç—å ¬´–ü–æ–ª–µ –ª—é–±–≤–∏¬ª</button>
        <button class="btn btn-outline" onclick="showScreen('practices-menu')">–ö –ø—Ä–∞–∫—Ç–∏–∫–∞–º</button>
      </div>
    </section>

    <section id="burnout-result" class="screen card" aria-hidden="true">
      <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h2>
      <div id="burnout-result-content" style="margin-top:12px"></div>
      <div style="margin-top:14px" class="controls">
        <button class="btn btn-primary" onclick="startPractice('love-field')">–ù–∞—á–∞—Ç—å ¬´–ü–æ–ª–µ –ª—é–±–≤–∏¬ª</button>
        <button class="btn btn-outline" onclick="showScreen('practices-menu')">–ö –ø—Ä–∞–∫—Ç–∏–∫–∞–º</button>
      </div>
    </section>

    <!-- Practices menu -->
    <section id="practices-menu" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('onboarding-screen')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–ú–µ–Ω—é –ø—Ä–∞–∫—Ç–∏–∫</h2>
      <p class="muted">–í—ã–±–µ—Ä–∏ –ø—Ä–∞–∫—Ç–∏–∫—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—á–µ—Ç—Å—è –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.</p>

      <div class="practice-row" style="margin-top:14px">
        <div class="card-small">
          <strong>üåø –ü–æ–ª–µ –ª—é–±–≤–∏</strong>
          <div class="muted">–ú—è–≥–∫–∞—è 10‚Äì15 –º–∏–Ω –º–µ–¥–∏—Ç–∞—Ü–∏—è</div>
          <div style="margin-top:10px"><button class="btn btn-primary" onclick="startPractice('love-field')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        </div>
        <div class="card-small">
          <strong>üîÅ –ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ</strong>
          <div class="muted">–ì–ª—É–±–æ–∫–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞</div>
          <div style="margin-top:10px"><button class="btn btn-outline" onclick="startPractice('transfiguration')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        </div>
        <div class="card-small">
          <strong>‚úçÔ∏è –°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π</strong>
          <div class="muted">–§–æ—Ä–º–∞ –Ω–∞ 3 –º–µ—Å—è—Ü–∞</div>
          <div style="margin-top:10px"><button class="btn btn-outline" onclick="startPractice('agreement')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        </div>
        <div class="card-small">
          <strong>üìù –î–Ω–µ–≤–Ω–∏–∫</strong>
          <div class="muted">–ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —à–∞–±–ª–æ–Ω</div>
          <div style="margin-top:10px"><button class="btn btn-outline" onclick="showScreen('journal-screen')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        </div>
      </div>
    </section>

    <!-- Practice: Love field -->
    <section id="practice-love-field" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('practices-menu')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–ü—Ä–∞–∫—Ç–∏–∫–∞ ¬´–ü–æ–ª–µ –ª—é–±–≤–∏¬ª</h2>
      <p class="muted">–í—ã–¥–µ–ª–∏ 10‚Äì15 –º–∏–Ω—É—Ç, —É–¥–æ–±–Ω–æ —Å—è–¥—å –∏ —Å–ª–µ–¥—É–π –∑–∞ –≥–æ–ª–æ—Å–æ–º.</p>

      <div style="margin-top:12px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
        <button class="btn btn-primary" onclick="playAudio()">–ê—É–¥–∏–æ–≤–µ—Ä—Å–∏—è (12 –º–∏–Ω)</button>
        <button class="btn btn-outline" onclick="showTextVersion()">–¢–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è</button>
      </div>

      <div id="audio-player" style="margin-top:16px; display:none">
        <div class="card-small">
          <h4>–ê—É–¥–∏–æ–º–µ–¥–∏—Ç–∞—Ü–∏—è</h4>
          <audio controls style="width:100%; margin-top:12px;">
            <source src="audio/love-field.mp3" type="audio/mpeg">
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ.
          </audio>
        </div>
      </div>

      <div id="text-version" style="margin-top:16px; display:none">
        <div class="card-small">
          <h4>–¢–µ–∫—Å—Ç –º–µ–¥–∏—Ç–∞—Ü–∏–∏</h4>
          <p class="muted">–°—è–¥—å—Ç–µ —É–¥–æ–±–Ω–æ... (–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ –≥–ª–∞–≤—ã)</p>
        </div>
      </div>
    </section>

    <!-- Practice: Transfiguration -->
    <section id="practice-transfiguration" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('practices-menu')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–ü—Ä–∞–∫—Ç–∏–∫–∞ ¬´–ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ¬ª</h2>
      <div style="margin-top:12px" class="practice-step card-small">
        <p class="muted"><strong>–í–∞–∂–Ω–æ:</strong> –µ—Å–ª–∏ –≤—ã –≤ –æ—Å—Ç—Ä–æ–π –∫—Ä–∏–∑–∏—Å–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.</p>
        <p class="muted">–ì–ª—É–±–æ–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–º–æ—Ü–∏—è–º–∏.</p>
      </div>

      <div id="transfiguration-content" style="margin-top:12px"></div>
    </section>

    <!-- Practice: Agreement -->
    <section id="practice-agreement" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('practices-menu')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π</h2>
      <p class="muted">–°–æ–∑–¥–∞–π –ª–∏—á–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ 3 –º–µ—Å—è—Ü–∞.</p>

      <div id="agreement-content" style="margin-top:12px"></div>
    </section>

    <!-- Journal -->
    <section id="journal-screen" class="screen card" aria-hidden="true">
      <button class="btn btn-ghost" onclick="showScreen('practices-menu')">‚Üê –ù–∞–∑–∞–¥</button>
      <h2>–î–Ω–µ–≤–Ω–∏–∫</h2>
      <p class="muted">–ö–æ—Ä–æ—Ç–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç —Å–º–æ—Ç—Ä–µ—Ç—å –≤–≥–ª—É–±—å.</p>

      <a class="btn btn-outline" style="margin-top:12px; display:inline-block" href="https://docs.google.com/document/d/1DxySrZSM9PSr9MPfajAT_DEXr1CzKj7evcElytXr4Lg/edit" target="_blank">–®–∞–±–ª–æ–Ω Google Docs</a>

      <div style="margin-top:12px">
        <button class="btn btn-primary" onclick="giveJournalQuestion()">–î–∞–π –≤–æ–ø—Ä–æ—Å</button>
        <div id="journal-question" style="margin-top:12px; display:none" class="card-small"></div>
      </div>

      <div style="margin-top:12px">
        <textarea class="journal" id="journal-entry" placeholder="–ó–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–∏..."></textarea>
        <div style="margin-top:8px" class="controls">
          <button class="btn btn-primary" onclick="saveJournal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn btn-ghost" onclick="setupReminders()">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
        </div>
      </div>
    </section>

  </main>

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</strong>
          <div class="muted" style="margin-top:6px">–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:700; color:var(--accent-1)">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</div>
          <div class="muted" style="font-size:13px">–í—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</div>
        </div>
      </div>

      <div style="margin-top:12px" class="side-stats">
        <div class="stat"><strong id="stat-last-test">‚Äî</strong><span>–ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç</span></div>
        <div class="stat"><strong id="stat-practice">‚Äî</strong><span>–ø–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–∞–∫—Ç–∏–∫–∞</span></div>
        <div class="stat"><strong id="stat-journal">‚Äî</strong><span>–ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å</span></div>
      </div>

      <div style="margin-top:12px">
        <div class="muted">–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</div>
        <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap">
          <button class="btn btn-outline" onclick="showScreen('diagnostics-menu')">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
          <button class="btn btn-outline" onclick="showScreen('practices-menu')">–ü—Ä–∞–∫—Ç–∏–∫–∏</button>
        </div>
      </div>

      <div class="muted" style="margin-top:12px">¬© –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è ‚Äî –±–µ—Ä–µ–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é</div>
    </div>
  </aside>
</div>

<script>
  // === Telegram WebApp init ===
  const tg = window.Telegram?.WebApp || { initDataUnsafe: {} };
  try{ if(window.Telegram && Telegram.WebApp){ Telegram.WebApp.ready(); Telegram.WebApp.expand(); } }catch(e){/* ignore */ }

  // === App state (kept structure from –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞) ===
  let appData = {
    sixLevelsAnswers: [],
    burnoutAnswers: [],
    agreementData: {},
    currentTransfigurationStep: 0
  };

  // –í–æ–ø—Ä–æ—Å—ã (—Ç–µ –∂–µ –º–∞—Å—Å–∏–≤—ã ‚Äî –æ—Å—Ç–∞–≤–∏–ª –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
  const sixLevelsQuestions = [
    "–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Å–≤–æ—ë —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ? (—ç–Ω–µ—Ä–≥–∏—è, —Å–æ–Ω, —Ç–µ–ª–µ—Å–Ω–æ–µ –æ—â—É—â–µ–Ω–∏–µ)",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–≤—è–∑—å —Å–æ —Å–≤–æ–∏–º–∏ –±–∞–∑–æ–≤—ã–º–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º–∏? (–µ–¥–∞, –æ—Ç–¥—ã—Ö, –¥–≤–∏–∂–µ–Ω–∏–µ)",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —É–≤–µ—Ä–µ–Ω—ã –≤ —Å–µ–±–µ –∫–∞–∫ –≤ –ª–∏—á–Ω–æ—Å—Ç–∏? (—Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞, –≥—Ä–∞–Ω–∏—Ü—ã)",
    "–ß—É–≤—Å—Ç–≤—É–µ—Ç–µ –ª–∏ –≤—ã –∫–æ–Ω—Ç–∞–∫—Ç —Å —Å–æ–±–æ–π? (–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–≤–æ–∏—Ö –∂–µ–ª–∞–Ω–∏–π, —ç–º–æ—Ü–∏–π)",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã —Å–≤–æ–∏–º–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏? (–±–ª–∏–∑–æ—Å—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∫–∞)",
    "–ï—Å—Ç—å –ª–∏ –≤ –≤–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö –æ—â—É—â–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –¥–æ–≤–µ—Ä–∏—è?",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–º—ã—Å–ª –≤ —Å–≤–æ–µ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?",
    "–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –æ—â—É—â–µ–Ω–∏–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–±–æ—Ç–µ?",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã –∂–∏–≤—ë—Ç–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å–≤–æ–∏–º–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏?",
    "–ß—É–≤—Å—Ç–≤—É–µ—Ç–µ –ª–∏ –≤—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Å–ª–æ–≤–æ–º –∏ –¥–µ–ª–æ–º?",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã –æ—â—É—â–∞–µ—Ç–µ —Å–≤—è–∑—å —Å —á–µ–º-—Ç–æ –±–æ–ª—å—à–∏–º, —á–µ–º –≤—ã —Å–∞–º–∏? (–¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å, –ø—Ä–∏—Ä–æ–¥–∞, –∏—Å–∫—É—Å—Å—Ç–≤–æ)",
    "–ï—Å—Ç—å –ª–∏ –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏ –æ—â—É—â–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è?"
  ];

  const burnoutQuestions = [
    "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –æ–ø—É—Å—Ç–æ—à–µ–Ω–Ω—ã–º(–æ–π) –Ω–∞ —Ä–∞–±–æ—Ç–µ.",
    "–ö –∫–æ–Ω—Ü—É —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è —è —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –∫–∞–∫ ¬´–≤—ã–∂–∞—Ç—ã–π –ª–∏–º–æ–Ω¬ª.",
    "–Ø —Å—Ç–∞–ª(–∞) –±–æ–ª–µ–µ —Ü–∏–Ω–∏—á–Ω—ã–º(–æ–π) –∏–ª–∏ –±–µ–∑—Ä–∞–∑–ª–∏—á–Ω—ã–º(–æ–π) –∫ –¥—Ä—É–≥–∏–º.",
    "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –º–æ–∏ —É—Å–∏–ª–∏—è –Ω–µ –ø—Ä–∏–Ω–æ—Å—è—Ç –∑–Ω–∞—á–∏–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.",
    "–Ø —Å —Ç—Ä—É–¥–æ–º –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É—é—Å—å –Ω–∞ –∑–∞–¥–∞—á–∞—Ö.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.",
    "–ú–µ–Ω—è —Ä–∞–∑–¥—Ä–∞–∂–∞—é—Ç –º–µ–ª–∫–∏–µ –Ω–µ—É–¥–∞—á–∏ –∏ –ø–æ–º–µ—Ö–∏.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —É—Å—Ç–∞–≤—à–∏–º(–µ–π) —É–∂–µ —Å —É—Ç—Ä–∞.",
    "–ú–Ω–µ —Å–ª–æ–∂–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –¥–≤–∏–≥–∞—é—Å—å –ø–æ –∑–∞–º–∫–Ω—É—Ç–æ–º—É –∫—Ä—É–≥—É.",
    "–Ø —Å—Ç–∞–ª(–∞) –º–µ–Ω–µ–µ —Ç–µ—Ä–ø–∏–º—ã–º(–æ–π) –∫ –∫–æ–ª–ª–µ–≥–∞–º –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞–º.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –º–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–µ –∑–∞–º–µ—á–∞—é—Ç.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ '—Å–≥–æ—Ä–∞—é'.",
    "–ú–Ω–µ –≤—Å—ë —Ç—Ä—É–¥–Ω–µ–µ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º –Ω–∞ —Ä–∞–±–æ—Ç–µ.",
    "–Ø —Å—Ç–∞–ª(–∞) –±–æ–ª–µ–µ —Ö–æ–ª–æ–¥–Ω—ã–º(–æ–π) –≤ –æ–±—â–µ–Ω–∏–∏.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ —Ä–∞–±–æ—Ç–∞ '–≤—ã—Å–∞—Å—ã–≤–∞–µ—Ç' –∏–∑ –º–µ–Ω—è –≤—Å—ë.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Å—å —Å –æ–±—ä—ë–º–æ–º —Ä–∞–±–æ—Ç—ã.",
    "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ —è –Ω–µ –¥–æ—Å—Ç–∏–≥–∞—é —Å–≤–æ–∏—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –º–æ–∏ —É—Å–∏–ª–∏—è –Ω–∞–ø—Ä–∞—Å–Ω—ã.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ.",
    "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –º–æ–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ —É—Ö—É–¥—à–∞—é—Ç—Å—è.",
    "–Ø —Å—Ç–∞–ª(–∞) –±–æ–ª–µ–µ —Ü–∏–Ω–∏—á–Ω—ã–º(–æ–π) –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ."
  ];

  const journalQuestions = [
    "–ß—Ç–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –º–æ–∂–µ—Ç –¥–∞—Ç—å –º–Ω–µ —Ö–æ—Ç—å –∫–∞–ø–ª—é —Ç–µ–ø–ª–∞?",
    "–ö–∞–∫–∞—è —á–∞—Å—Ç—å –º–µ–Ω—è –ø—Ä–æ—Å–∏—Ç –≤–Ω–∏–º–∞–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è?",
    "–ß—Ç–æ —è –º–æ–≥—É –ø—Ä–æ—Å—Ç–∏—Ç—å —Å–µ–±–µ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç?",
    "–ì–¥–µ —è —á—É–≤—Å—Ç–≤—É—é –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ? –ß—Ç–æ –æ–Ω–æ —Ö–æ—á–µ—Ç —Å–∫–∞–∑–∞—Ç—å?",
    "–ö–∞–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —è —Ö–æ—á—É –ø—Ä–æ—è–≤–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è?"
  ];

  // ===== Navigation util =====
  function showScreen(id){
    document.querySelectorAll('.screen').forEach(s => {
      s.classList.remove('active');
      s.setAttribute('aria-hidden','true');
    });
    const el = document.getElementById(id);
    if(el){
      el.classList.add('active');
      el.setAttribute('aria-hidden','false');
      window.scrollTo({top:0,behavior:'smooth'});
    }
    // minor UI sync
    if(id === 'six-levels-result') document.getElementById('stat-last-test').textContent = '6 —É—Ä–æ–≤–Ω–µ–π';
  }

  // Initial transition from loading
  setTimeout(()=> showScreen('onboarding-screen'), 900);

  // ===== Six levels test =====
  function startSixLevelsTest(){
    appData.sixLevelsAnswers = [];
    showScreen('six-levels-screen');
    showSixLevelsQuestion(0);
  }

  function showSixLevelsQuestion(index){
    const container = document.getElementById('six-levels-content');
    const total = sixLevelsQuestions.length;
    if(index >= total){
      calculateSixLevelsResult();
      return;
    }
    const progressPercent = Math.round((index/total)*100);
    container.innerHTML = `
      <div class="progress" aria-hidden="true"><i style="width:${progressPercent}%"></i></div>
      <div class="question">
        <p>–í–æ–ø—Ä–æ—Å ${index+1} –∏–∑ ${total}</p>
        <div style="margin-top:8px">${escapeHtml(sixLevelsQuestions[index])}</div>
      </div>
      <div class="score-row" style="margin-top:16px">
        ${Array.from({length:10}, (_,i)=> {
          const v = i+1;
          return `<button class="score" onclick="answerSixLevels(${index},${v})" aria-label="–û—Ü–µ–Ω–∫–∞ ${v}">${v}</button>`;
        }).join('')}
      </div>
    `;
  }

  function answerSixLevels(qIdx, score){
    appData.sixLevelsAnswers[qIdx] = score;
    showSixLevelsQuestion(qIdx+1);
  }

  function calculateSixLevelsResult(){
    // guard: ensure array full
    const answers = appData.sixLevelsAnswers.map(v => Number(v) || 0);
    // groups of 2
    const levels = {
      physical: avg(answers[0],answers[1]),
      personal: avg(answers[2],answers[3]),
      interpersonal: avg(answers[4],answers[5]),
      professional: avg(answers[6],answers[7]),
      principled: avg(answers[8],answers[9]),
      spiritual: avg(answers[10],answers[11])
    };
    // partition
    const strengths = Object.entries(levels).filter(([k,v])=>v>=7);
    const tensions = Object.entries(levels).filter(([k,v])=>v>=4 && v<7);
    const critical = Object.entries(levels).filter(([k,v])=>v<4);
    const names = {
      physical:'–§–∏–∑–∏—á–µ—Å–∫–∏–π',
      personal:'–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π',
      interpersonal:'–ú–µ–∂–ª–∏—á–Ω–æ—Å—Ç–Ω—ã–π',
      professional:'–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π',
      principled:'–ü—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω—ã–π',
      spiritual:'–î—É—Ö–æ–≤–Ω—ã–π'
    };

    let html = `<div style="display:flex;flex-direction:column;gap:10px">`;
    if(strengths.length){
      html += `<div class="badge good">üü¢ –°–∏–ª—å–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏: ${strengths.map(([k,v])=>`${names[k]} (${Math.round(v)}/10)`).join(', ')}</div>`;
    }
    if(tensions.length){
      html += `<div class="badge warn">üü° –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ: ${tensions.map(([k,v])=>`${names[k]} (${Math.round(v)}/10)`).join(', ')}</div>`;
    }
    if(critical.length){
      html += `<div class="badge danger">üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏: ${critical.map(([k,v])=>`${names[k]} (${Math.round(v)}/10)`).join(', ')}</div>`;
    }
    html += `<div class="card-small" style="margin-top:8px"><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</strong><div class="muted" style="margin-top:6px">–ü–µ—Ä–µ—á–∏—Ç–∞–π—Ç–µ –≥–ª–∞–≤—ã 10, 12, 19. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞: ¬´–ü–æ–ª–µ –ª—é–±–≤–∏¬ª.</div></div>`;
    html += `</div>`;

    document.getElementById('six-levels-result-content').innerHTML = html;
    showScreen('six-levels-result');
    document.getElementById('stat-last-test').textContent = '6 —É—Ä–æ–≤–Ω–µ–π';
  }

  // ===== Burnout test =====
  function startBurnoutTest(){
    showScreen('burnout-screen');
    // initialization handled by initBurnoutTest()
  }
  function initBurnoutTest(){
    appData.burnoutAnswers = [];
    showBurnoutQuestion(0);
  }
  function showBurnoutQuestion(index){
    const container = document.getElementById('burnout-content');
    const total = burnoutQuestions.length;
    if(index >= total){
      calculateBurnoutResult(); return;
    }
    const progressPercent = Math.round((index/total)*100);
    container.innerHTML = `
      <div class="progress" aria-hidden="true"><i style="width:${progressPercent}%"></i></div>
      <div class="question"><p>${index+1} / ${total}</p><div style="margin-top:8px">${escapeHtml(burnoutQuestions[index])}</div></div>
      <div style="display:grid; grid-template-columns: repeat(2,1fr); gap:8px; margin-top:12px">
        <button class="btn btn-ghost" onclick="answerBurnout(${index},0)">–ù–∏–∫–æ–≥–¥–∞</button>
        <button class="btn btn-ghost" onclick="answerBurnout(${index},1)">–û—á–µ–Ω—å —Ä–µ–¥–∫–æ</button>
        <button class="btn btn-ghost" onclick="answerBurnout(${index},2)">–†–µ–¥–∫–æ</button>
        <button class="btn btn-ghost" onclick="answerBurnout(${index},3)">–ò–Ω–æ–≥–¥–∞</button>
        <button class="btn btn-ghost" onclick="answerBurnout(${index},4)">–ß–∞—Å—Ç–æ</button>
        <button class="btn btn-ghost" onclick="answerBurnout(${index},5)">–û—á–µ–Ω—å —á–∞—Å—Ç–æ</button>
        <button class="btn btn-ghost" onclick="answerBurnout(${index},6)">–ö–∞–∂–¥—ã–π –¥–µ–Ω—å</button>
      </div>
    `;
  }
  function answerBurnout(idx,score){
    appData.burnoutAnswers[idx]=score;
    showBurnoutQuestion(idx+1);
  }
  function calculateBurnoutResult(){
    const a = appData.burnoutAnswers.map(v=>Number(v)||0);
    const EI_q=[0,1,2,5,7,12,13,15,19];
    const DP_q=[4,9,10,14,21];
    const RPD_q=[3,6,8,11,16,17,18,20];
    const EI = EI_q.reduce((s,i)=>s+(a[i]||0),0);
    const DP = DP_q.reduce((s,i)=>s+(a[i]||0),0);
    const RPD = RPD_q.reduce((s,i)=>s+(a[i]||0),0);
    const getLevel=(score,low,med)=> score>med?'–í—ã—Å–æ–∫–∏–π':(score>=low?'–°—Ä–µ–¥–Ω–∏–π':'–ù–∏–∑–∫–∏–π');
    const eiL=getLevel(EI,17,26);
    const dpL=getLevel(DP,6,9);
    const rpdL=getLevel(RPD,32,39);
    const html = `
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="badge ${eiL==='–í—ã—Å–æ–∫–∏–π'?'danger':eiL==='–°—Ä–µ–¥–Ω–∏–π'?'warn':'good'}">üî• –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å—Ç–æ—â–µ–Ω–∏–µ: ${eiL}</div>
        <div class="badge ${dpL==='–í—ã—Å–æ–∫–∏–π'?'danger':dpL==='–°—Ä–µ–¥–Ω–∏–π'?'warn':'good'}">üë§ –î–µ–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è: ${dpL}</div>
        <div class="badge ${rpdL==='–í—ã—Å–æ–∫–∏–π'?'danger':rpdL==='–°—Ä–µ–¥–Ω–∏–π'?'warn':'good'}">üìâ –ß—É–≤—Å—Ç–≤–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: ${rpdL}</div>
        <div class="card-small" style="margin-top:6px">
          <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</strong>
          <div class="muted" style="margin-top:6px">–°–µ–π—á–∞—Å –≤–∞–∂–µ–Ω –º—è–≥–∫–∏–π —É—Ö–æ–¥ –∑–∞ —Å–æ–±–æ–π: –æ—Ç–¥—ã—Ö, –≥—Ä–∞–Ω–∏—Ü—ã, –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≥–ª–∞–≤–∞–º 1 –∏ 7.</div>
        </div>
      </div>
    `;
    document.getElementById('burnout-result-content').innerHTML = html;
    showScreen('burnout-result');
    document.getElementById('stat-last-test').textContent = '–í—ã–≥–æ—Ä–∞–Ω–∏–µ';
  }

  // ===== Practices =====
  function startPractice(type){
    if(type === 'love-field') showScreen('practice-love-field');
    if(type === 'transfiguration') {
      appData.currentTransfigurationStep = 0;
      showTransfigurationStep();
      showScreen('practice-transfiguration');
    }
    if(type === 'agreement'){
      appData.agreementData={};
      appData.currentAgreementStep=0;
      showAgreementStep();
      showScreen('practice-agreement');
    }
    document.getElementById('stat-practice').textContent = prettifyPracticeName(type);
  }
  function prettifyPracticeName(k){
    return ({'love-field':'–ü–æ–ª–µ –ª—é–±–≤–∏','transfiguration':'–ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω–∏–µ','agreement':'–°–æ–≥–ª–∞—à–µ–Ω–∏–µ'}[k])||'‚Äî';
  }

  function playAudio(){
    document.getElementById('audio-player').style.display='block';
  }
  function showTextVersion(){
    document.getElementById('text-version').style.display='block';
  }

  // Transfiguration steps (kept original content)
  const transfigurationSteps = [
    "–°—è–¥—å —É–¥–æ–±–Ω–æ, –∑–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞, —Å–¥–µ–ª–∞–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–ª—É–±–æ–∫–∏—Ö –≤–¥–æ—Ö–æ–≤. –í–æ–π–¥–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ü–æ–ª—è –õ—é–±–≤–∏. –ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤(–∞), –Ω–∞–ø–∏—à–∏ '–≥–æ—Ç–æ–≤'.",
    "–¢–µ–ø–µ—Ä—å —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Å—è –Ω–∞ —á—É–≤—Å—Ç–≤–µ, —Å –∫–æ—Ç–æ—Ä—ã–º —Ö–æ—á–µ—à—å –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å. –ß—Ç–æ —ç—Ç–æ? –û–±–∏–¥–∞, –≥–Ω–µ–≤, —Ç—Ä–µ–≤–æ–≥–∞? –ù–∞–∑–æ–≤–∏ –µ–≥–æ –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º.",
    "–•–æ—Ä–æ—à–æ. –¢–µ–ø–µ—Ä—å –Ω–∞–π–¥–∏ —ç—Ç–æ —á—É–≤—Å—Ç–≤–æ –≤ —Å–≤–æ—ë–º —Ç–µ–ª–µ. –ì–¥–µ –æ–Ω–æ –∂–∏–≤—ë—Ç? –í –≥—Ä—É–¥–∏, –≤ –∂–∏–≤–æ—Ç–µ, –≤ –≥–æ—Ä–ª–µ? –û–ø–∏—à–∏ –µ–≥–æ.",
    "–¢–µ–ø–µ—Ä—å –º—ã—Å–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–∏—Å—å –∫ —ç—Ç–æ–º—É –æ–±—Ä–∞–∑—É. –°–∫–∞–∂–∏ –µ–º—É: '–Ø —Ç–µ–±—è –≤–∏–∂—É'. –ü–æ—á—É–≤—Å—Ç–≤—É–π —ç—Ç–æ. –ê —Ç–µ–ø–µ—Ä—å —Å–ø—Ä–æ—Å–∏ –µ–≥–æ: '–î–ª—è —á–µ–≥–æ —Ç—ã –∑–¥–µ—Å—å? –û—Ç —á–µ–≥–æ —Ç—ã –º–µ–Ω—è –∑–∞—â–∏—â–∞–µ—à—å?'. –ù–∞–ø–∏—à–∏ –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–¥–µ—Ç.",
    "–ü–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏ —ç—Ç–æ —á—É–≤—Å—Ç–≤–æ –∑–∞ —Å–ª—É–∂–±—É –∏ –∑–∞—â–∏—Ç—É. –ü—Ä–µ–¥–ª–æ–∂–∏ –µ–º—É –Ω–æ–≤—É—é —Ä–æ–ª—å ‚Äî –±—ã—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º —Å–∏–ª—ã. –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?",
    "–ú–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è. –ö–æ–≥–¥–∞ –æ—Ç–∫—Ä–æ–µ—à—å –≥–ª–∞–∑–∞, –Ω–∞–ø–∏—à–∏, –∫–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–µ–π—á–∞—Å."
  ];

  function showTransfigurationStep(){
    const idx = appData.currentTransfigurationStep;
    const cont = document.getElementById('transfiguration-content');
    if(idx < transfigurationSteps.length){
      cont.innerHTML = `
        <div class="steps" aria-hidden="true">
          ${transfigurationSteps.map((_,i)=>`<div class="dot ${i===idx?'active':''}" ></div>`).join('')}
        </div>
        <div class="card-small">
          <strong>–®–∞–≥ ${idx+1} –∏–∑ ${transfigurationSteps.length}</strong>
          <p class="muted" style="margin-top:8px">${escapeHtml(transfigurationSteps[idx])}</p>
          <textarea id="transfiguration-answer" class="journal" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."></textarea>
          <div style="margin-top:10px" class="controls">
            <button class="btn btn-primary" onclick="nextTransfigurationStep()">–î–∞–ª–µ–µ</button>
          </div>
        </div>
      `;
    } else {
      cont.innerHTML = `<div style="text-align:center"><h3>–ü—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h3><p class="muted">–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ —Ä–∞–±–æ—Ç—É.</p><div style="margin-top:8px"><button class="btn btn-primary" onclick="completePractice('transfiguration')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div></div>`;
    }
  }

  function nextTransfigurationStep(){
    const v = document.getElementById('transfiguration-answer')?.value?.trim();
    if(!v){ alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.'); return; }
    appData.currentTransfigurationStep++;
    showTransfigurationStep();
  }

  // Agreement steps
  const agreementSteps = [
    "–ö–∞–∫–æ–µ –æ–¥–Ω–æ –≥–ª–∞–≤–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ç—ã —Ö–æ—á–µ—à—å —Ä–∞–∑–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–∏–µ 3 –º–µ—Å—è—Ü–∞?",
    "–ù–∞–ø–∏—à–∏ 3 –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç —Ç–µ–±–µ —Ä–∞–∑–≤–∏—Ç—å —ç—Ç–æ –∫–∞—á–µ—Å—Ç–≤–æ.",
    "–ö–∞–∫–∏–µ 1‚Äì2 —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è —Ç—ã –±—É–¥–µ—à—å —Å–æ–≤–µ—Ä—à–∞—Ç—å?",
    "–û—Ç –∫–∞–∫–æ–π –æ–¥–Ω–æ–π —Ä–∞–∑—Ä—É—à–∞—é—â–µ–π –ø—Ä–∏–≤—ã—á–∫–∏ —Ç—ã –≥–æ—Ç–æ–≤ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –Ω–∞ —ç—Ç–æ –≤—Ä–µ–º—è?"
  ];

  function showAgreementStep(){
    const idx = appData.currentAgreementStep || 0;
    const cont = document.getElementById('agreement-content');
    if(idx < agreementSteps.length){
      cont.innerHTML = `
        <div class="steps">${agreementSteps.map((_,i)=>`<div class="dot ${i===idx?'active':''}"></div>`).join('')}</div>
        <div class="card-small">
          <strong>–®–∞–≥ ${idx+1}</strong>
          <p class="muted" style="margin-top:8px">${escapeHtml(agreementSteps[idx])}</p>
          <textarea id="agreement-answer" class="journal" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..."></textarea>
          <div style="margin-top:10px"><button class="btn btn-primary" onclick="nextAgreementStep()">–î–∞–ª–µ–µ</button></div>
        </div>
      `;
    } else {
      generateAgreementDocument();
    }
  }

  function startAgreementSteps(){ appData.agreementData={}; appData.currentAgreementStep=0; showAgreementStep(); }
  function nextAgreementStep(){
    const v = document.getElementById('agreement-answer')?.value?.trim();
    if(!v){ alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç.'); return; }
    appData.agreementData[`step${appData.currentAgreementStep+1}`]=v;
    appData.currentAgreementStep++;
    showAgreementStep();
  }

  function generateAgreementDocument(){
    const cont = document.getElementById('agreement-content');
    const today = new Date();
    const end = new Date(); end.setMonth(end.getMonth()+3);
    const fmt = d => d.toLocaleDateString('ru-RU',{day:'2-digit',month:'2-digit',year:'numeric'});
    const name = (tg.initDataUnsafe?.user?.first_name) ? escapeHtml(tg.initDataUnsafe.user.first_name) : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    cont.innerHTML = `
      <div class="card-small">
        <h3 style="margin:0 0 8px">–ú–æ—ë —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π</h3>
        <div class="muted">–°—Ä–æ–∫: ${fmt(today)} ‚Äî ${fmt(end)}</div>
        <div style="margin-top:10px">
          <strong>–ö–∞—á–µ—Å—Ç–≤–æ:</strong><div class="muted">${escapeHtml(appData.agreementData.step1||'‚Äî')}</div>
          <strong style="margin-top:6px; display:block">–ü—Ä–∏–Ω—Ü–∏–ø—ã:</strong><div class="muted">${escapeHtml(appData.agreementData.step2||'‚Äî')}</div>
          <strong style="margin-top:6px; display:block">–ü—Ä–∞–∫—Ç–∏–∫–∏:</strong><div class="muted">${escapeHtml(appData.agreementData.step3||'‚Äî')}</div>
          <strong style="margin-top:6px; display:block">–û—Ç–∫–∞–∑—ã–≤–∞—é—Å—å:</strong><div class="muted">${escapeHtml(appData.agreementData.step4||'‚Äî')}</div>
        </div>
        <div style="margin-top:12px" class="muted">–Ø, ${name}, –∑–∞–∫–ª—é—á–∞—é —ç—Ç–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å —Å–æ–±–æ–π.</div>
        <div style="margin-top:10px"><button class="btn btn-primary" onclick="completePractice('agreement')">–ì–æ—Ç–æ–≤–æ</button></div>
      </div>
    `;
  }

  function completePractice(pr){
    try{ if(window.Telegram && Telegram.WebApp) Telegram.WebApp.sendData(JSON.stringify({action:'practice_completed',practice:pr,timestamp:Date.now()})); }catch(e){}
    showScreen('practices-menu');
  }

  // ===== Journal helpers =====
  function giveJournalQuestion(){
    const q = journalQuestions[Math.floor(Math.random()*journalQuestions.length)];
    const el = document.getElementById('journal-question');
    el.innerHTML = `<strong>${escapeHtml(q)}</strong>`;
    el.style.display='block';
  }
  function saveJournal(){
    const text = document.getElementById('journal-entry')?.value?.trim();
    if(!text){ alert('–ù–µ—á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å. –ù–∞–ø–∏—à–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫.'); return; }
    document.getElementById('stat-journal').textContent = new Date().toLocaleString();
    alert('–ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏.');
    document.getElementById('journal-entry').value='';
  }
  function setupReminders(){ alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏.'); }

  function reportBug(){
    try{ if(window.Telegram && Telegram.WebApp) Telegram.WebApp.sendData(JSON.stringify({action:'report_bug'})); }catch(e){}
    alert('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–º–∞–Ω–¥–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.');
    showScreen('onboarding-screen');
  }

  // ===== Utilities =====
  function avg(a,b){ return ((Number(a)||0)+(Number(b)||0))/2; }
  function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }

  // Expose some functions globally (needed for inline onclick)
  window.showScreen = showScreen;
  window.startSixLevelsTest = startSixLevelsTest;
  window.startBurnoutTest = startBurnoutTest;
  window.initBurnoutTest = initBurnoutTest;
  window.startPractice = startPractice;
  window.playAudio = playAudio;
  window.showTextVersion = showTextVersion;
  window.giveJournalQuestion = giveJournalQuestion;
  window.setupReminders = setupReminders;
  window.reportBug = reportBug;
  window.startAgreementSteps = startAgreementSteps;
  window.startTransfigurationSteps = () => { appData.currentTransfigurationStep=0; showTransfigurationStep(); showScreen('practice-transfiguration'); };
  window.saveJournal = saveJournal;

</script>

</body>
</html>
